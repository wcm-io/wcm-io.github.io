<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from src/site/markdown/configuration.md at 2021-09-05

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>DAM Asset Service &#x2013; Configuration</title>
    <link rel="stylesheet" href="./css/maven-base.css" />
    <link rel="stylesheet" href="./css/maven-theme.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<div id="bannerLeft">DAM Asset Service
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2021-09-05</span>
          &#xA0;| <span id="projectVersion">Version: 1.4.1-SNAPSHOT</span>
      </div>
      <div class="xright"><a href="./" title="DAM Asset Service">DAM Asset Service</a>      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Parent Project</h5>
    <ul>
     <li class="none"><a href="../index.html" title="DAM Extensions">DAM Extensions</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="project-info.html" title="Project Information">Project Information</a></li>
     <li class="collapsed"><a href="project-reports.html" title="Project Reports">Project Reports</a></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<section>
<h2><a name="Configuration"></a>Configuration</h2><section>
<h3><a name="OSGi_configuration"></a>OSGi configuration</h3>
<p>The DAM asset service can be configured via the &#x201c;wcm.io DAM Asset Service&#x201d; entry in the Felix Web Console.</p>
<p>Supported parameters:</p>
<ul>

<li><b>Asset Selector</b>: Selector for attaching REST service to DAM asset paths.</li>
<li><b>Data Version Selector</b>: Selector for attaching REST service to DAM folder for getting data version.</li>
<li><b>Data Version Strategy</b>: Strategy for building the data versions (see below)</li>
<li><b>Update Interval (sec)</b>: Updating interval for calculating data versions in seconds. If multiple changes to the DAM folders contents are detected within this interval they are collected. This is only used by the &#x2018;aggregated checksum&#x2019; strategy.</li>
<li><b>DAM paths</b>: List of DAM paths for which the asset service should be active. If not set, the service is active for all paths.</li>
</ul>
<p>If not path is given it defaults to <code>/content/dam</code>.</p></section><section>
<h3><a name="Data_Version_Strategies"></a>Data Version Strategies</h3>
<p>The DAM asset service generates a data version for each configured DAM asset path. The data version is updated whenever an asset was changed within this subtree of DAM. There are multiple strategies to generate such a data version available.</p>
<p>Notice on handling data versions within in your application: You should not try to interpret the data version string but take it just as an arbitrary string. You should not compare data versions, it is not guaranteed that the lexical ordering of two data versions matches with the temporal order.</p><section>
<h4><a name="timestamp_Data_Version_Strategy_.28default.29"></a>timestamp Data Version Strategy (default)</h4>
<p>Simple strategy to generate data versions - on each DAM event a new timestamp is generated and returned as data version. Please be aware that this does not produce stable data versions across a cluster of AEM instances.</p>
<p>It should only be used if there is only one AEM instance generating the data version, or some sort of long-stable stickyness is applied on the load balancer.</p></section><section>
<h4><a name="checksum_Data_Version_Strategy"></a>checksum Data Version Strategy</h4>
<p>Strategy that generates a checksum bases on all DAM asset&#x2019;s path and last modified dates within the DAM asset folder.</p>
<p>The aggregated checksum is built by executing a JCR query using the AEM-predefined OAK index <code>damAssetLucene</code>. Executing the query does not touch the JCR content at all, it only reads JCR path and selected properties from the lucene index. This query is executed max. once during the &#x201c;update interval&#x201d;, and only if DAM events occurred since the last checksum generation.</p>
<p>This strategy produced consistent data versions across multiple AEM instances.</p>
<p>To use this strategy a service use has to be configured, see below.</p></section></section><section>
<h3><a name="Service_User_Configuration"></a>Service User Configuration</h3>
<p>If the &#x2018;checksum&#x2019; data version strategy is used the DAM asset service needs a principal-based service user mapping entry like this:</p>

<div class="source">
<div class="source">
<pre>  org.apache.sling.serviceusermapping.impl.ServiceUserMapperImpl.amended-myapp-dam-asset-service
    user.mapping=[&quot;io.wcm.dam.asset-service\=[dam-reader-service]&quot;]
</pre></div></div>

<p>The built-in principal <code>dam-reader-service</code> has read access to <code>/content/dam</code>.</p>
<p>This configuration is required <b>only on author instances</b>.</p></section></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2014&#x2013;2021<a href="https://wcm.io">wcm.io</a>.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>