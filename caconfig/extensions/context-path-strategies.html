
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2024-07-01
 Rendered using Reflow Maven Skin 1.2.0 (https://github.com/wcm-io/wcm-io-tooling/tree/develop/maven/skins/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

  <head>
    <meta charset="UTF-8" />
    <title>Context Path Strategies | wcm.io</title>

    <link rel="shortcut icon" href="https://wcm.io/images/favicon.ico">
    <link rel="apple-touch-icon" href="https://wcm.io/images/favicon-152.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="wcm.io - Libraries and extensions for AEM applications" />
    <meta http-equiv="content-language" content="en" />

    <link href="https://wcm.io/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://wcm.io/css/docs.css" rel="stylesheet" />
    <link href="https://wcm.io/css/reflow-skin.css" rel="stylesheet" />
    <link href="https://wcm.io/css/highlightjs-style-github.min.css" rel="stylesheet" />

    <link href="https://wcm.io/css/lightbox.css" rel="stylesheet" />

    <link href="https://wcm.io/css/site.css" rel="stylesheet" />
    <link href="https://wcm.io/css/print.css" rel="stylesheet" media="print" />


  </head>

  <body class="page-context-path-strategies project-io.wcm.caconfig.extensions" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../..">wcm.io</a>
          <div class="nav-collapse collapse" id="top-nav-collapse">
            <ul class="nav pull-right">
              <li ><a href="https://github.com/wcm-io" title="GitHub project" class="externalLink">GitHub project</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Categories <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li ><a href="../../wcm/" title="WCM">WCM</a></li>
                  <li ><a href="../" title="Context-Aware Configuration">Context-Aware Configuration</a></li>
                  <li ><a href="../../handler/" title="Handler">Handler</a></li>
                  <li ><a href="../../sling/" title="Sling Extensions">Sling Extensions</a></li>
                  <li ><a href="../../testing/" title="Testing">Testing</a></li>
                  <li ><a href="../../samples/" title="Samples">Samples</a></li>
                  <li ><a href="../../tooling/" title="Tooling">Tooling</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contribute <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li ><a href="../../contribute.html" title="Contribute">Contribute</a></li>
                  <li ><a href="../../manifest.html" title="Manifest">Manifest</a></li>
                  <li ><a href="https://github.com/wcm-io" title="Issues" class="externalLink">Issues</a></li>
                  <li ><a href="https://wcm-io.atlassian.net/wiki/" title="Wiki" class="externalLink">Wiki</a></li>
                  <li ><a href="../../mailing-lists.html" title="Mailing Lists">Mailing Lists</a></li>
                  <li ><a href="https://github.com/wcm-io" title="Fork on GitHub" class="externalLink">Fork on GitHub</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

  <div class="container">

  <!-- Masthead
  ================================================== -->

  <header>
  <div class="jumbotron subhead">
    <div class="row" id="banner">
      <div class="span12">
        <div class="pull-left">
          <a href="../../" id="bannerLeft"><h1><img src="https://wcm.io/images/favicon-16@3x.png"/> wcm.io</h1></a>
          <p class="lead">Libraries and extensions for AEM applications</p>
        </div>
        <div class="pull-right">
        </div>
      </div>
    </div>
  </div>
    <div>
      <ul class="breadcrumb">
        <li><a href="../../" title="wcm.io">wcm.io</a></li>
        <li class="divider">/</li>
        <li><a href="../" title="Context-Aware Configuration">Context-Aware Configuration</a></li>
        <li class="divider">/</li>
        <li><a href="./" title="Context-Aware Configuration Extensions for AEM">Context-Aware Configuration Extensions for AEM</a></li>
        <li class="divider">/</li>
        <li>Context Path Strategies</li>
      </ul>
    </div>
  </header>

  <div class="main-body">
  <div class="row">
    <div class="span8">
      <div class="body-content">
<section> 
 <div class="page-header">
  <h2 id="Context_Path_Strategies">Context Path Strategies</h2>
 </div> 
 <section> 
  <h3 id="Overview">Overview</h3> 
  <p>To provide context-aware configuration you have to define the context first. In most cases a context is a certain subtree below <code>/content</code> - e.g. one site or a group of sites. In Sling Context-Aware Configuration this is possible by setting <code>@sling:configRef</code> attributes on the root page of each context's subtree (see [Contexts and configuration references][sling-caconfig-contexts]).</p> 
  <p>But when you have a lot of contexts (e.g. 1,000 sites worldwide), and all your context/config path mappings follow the same schema, it is tedious to define all these <code>@sling:configRef</code> properties and keeping them in sync when the content moves.</p> 
  <p>wcm.io Context-Aware Configuration Extensions for AEM provides two alternatives for defining contexts without the need to set such properties. Both are configured via OSGi and support filtering by context path. You can define different strategies for different content areas by adding multiple factory configurations.</p> 
 </section> 
 <section> 
  <h3 id="Context_Path_Strategy_Absolute_Parents">Context Path Strategy: Absolute Parents</h3> 
  <p>OSGi factory configuration: “wcm.io Context-Aware Configuration Context Path Strategy: Absolute Parents”:</p> 
  <ul> 
   <li><b>Absolute Levels</b>: List of absolute parent levels that should be considered as context roots. Example: Absolute parent level 1 of <code>/foo/bar/test</code> is <code>/foo/bar</code>.</li> 
   <li><b>Context path whitelist</b>: Expression to match context paths. Context paths matching this expression are allowed. Use groups to reference them in configPathPatterns.</li> 
   <li><b>Context path blacklist</b>: Expression to match context paths. Context paths matching this expression are not allowed.</li> 
   <li><b>Config path patterns</b>: Expression to derive the config path from the context path. Regex group references like <code>$1</code> can be used.</li> 
   <li><b>Service Ranking</b>: Priority of context path strategy</li> 
  </ul> 
  <p>This strategy detects context paths at absolute parent levels (starting at <code>/content</code> with level=0). It only accepts paths that match the whitelist and does not match the blacklist, and uses the nearest accepted parent if the current path is not accepted.</p> 
  <p>Example:</p> 
  <div class="source"> 
   <pre><code>  io.wcm.caconfig.extensions.contextpath.impl.AbsoluteParentContextPathStrategy-example
    levels=I["2","3"]
    contextPathRegex="^/content(/.+)$"
    configPathPatterns=["/conf$1"]
    contextPathBlacklistRegex="^.*/tools(/config(/.+)?)?$"
</code></pre> 
  </div> 
  <p>With this configuration the strategy produces the following results:</p> 
  <table border="0" class="bodyTable table table-striped table-hover"> 
   <thead> 
    <tr class="a"> 
     <th> </th> 
     <th>Content path</th> 
     <th>Detected context path</th> 
     <th>Derived config path</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr class="b"> 
     <td align="left">a)</td> 
     <td><code>/content/brand1/region1</code></td> 
     <td><code>/content/brand1/region1</code></td> 
     <td><code>/conf/brand1/region1</code></td> 
    </tr> 
    <tr class="a"> 
     <td align="left">b)</td> 
     <td><code>/content/brand1/region1/country1</code></td> 
     <td><code>/content/brand1/region1/country1</code></td> 
     <td><code>/conf/brand1/region1/country1</code></td> 
    </tr> 
    <tr class="b"> 
     <td align="left">c)</td> 
     <td><code>/content/brand1/region1/country1/en/page1</code></td> 
     <td><code>/content/brand1/region1/country1</code></td> 
     <td><code>/conf/brand1/region1/country1</code></td> 
    </tr> 
    <tr class="a"> 
     <td align="left">d)</td> 
     <td><code>/content/brand1/region1/tools/config</code></td> 
     <td><code>/content/brand1/region1</code></td> 
     <td><code>/conf/brand1/region1</code></td> 
    </tr> 
   </tbody> 
  </table> 
  <p>Explanation:</p> 
  <ul> 
   <li>a) Direct match with level 2</li> 
   <li>b) Direct match with level 3</li> 
   <li>c) Page with level 5, next matching absolute parent is level 3</li> 
   <li>d) Configuration editor page with level 4 which is blacklisted, next matching absolute parent is level 2</li> 
  </ul> 
 </section> 
 <section> 
  <h3 id="Context_Path_Strategy_Root_Templates">Context Path Strategy: Root Templates</h3> 
  <p>OSGi factory configuration: “wcm.io Context-Aware Configuration Context Path Strategy: Root Template”:</p> 
  <ul> 
   <li><b>Templates</b>: List of template paths allowed for context root pages.</li> 
   <li><b>Min. Level</b>: Minimum allowed absolute parent level. Example: Absolute parent level 1 of <code>/foo/bar/test</code> is <code>/foo/bar</code>.</li> 
   <li><b>Max. Level</b>: Maximum allowed absolute parent level. Example: Absolute parent level 1 of <code>/foo/bar/test</code> is <code>/foo/bar</code>.</li> 
   <li><b>Context path whitelist</b>: Expression to match context paths. Context paths matching this expression are allowed. Use groups to reference them in configPathPatterns.</li> 
   <li><b>Config path patterns</b>: Expression to derive the config path from the context path. Regex group references like <code>$1</code> can be used.</li> 
   <li><b>Service Ranking</b>: Priority of context path strategy</li> 
  </ul> 
  <p>This strategy detects context paths by matching parent pages against a list of allowed templates for context root. All page between min and max level up to a page with a page matching the templates are defined as context paths.</p> 
  <p>Example:</p> 
  <div class="source"> 
   <pre><code>  io.wcm.caconfig.extensions.contextpath.impl.RootTemplateContextPathStrategy-example
    templatePaths=["/apps/app1/templates/homepage"]
    minLevel=I"1"
    maxLevel=I"4"
    contextPathRegex="^/content(/.+)$"
    configPathPatterns=["/conf$1"]
</code></pre> 
  </div> 
  <p>If a page with the configured template exists at level 3 (e.g. <code>/content/tenant/country/en</code>), the levels 1, 2, 3 would be considered as context paths (e.g. <code>/content/tenant</code>, <code>/content/tenant/country</code>, <code>/content/tenant/country/en</code>).</p> 
 </section> 
</section>
      </div>
    </div>
    <div class="span4">
      <div id="toc-sidebar">
        <div class="well">
          <ul class="nav nav-list">
            <li class="nav-header">Table of Contents</li>
    <li class="dropdown"><a href="#Context_Path_Strategies" title="Context Path Strategies">Context Path Strategies <b class="caret"></b></a>
      <ul class="nav nav-list">
    <li><a href="#Overview" title="Overview">Overview</a>
    <li><a href="#Context_Path_Strategy_Absolute_Parents" title="Context Path Strategy: Absolute Parents">Context Path Strategy: Absolute Parents</a>
    <li><a href="#Context_Path_Strategy_Root_Templates" title="Context Path Strategy: Root Templates">Context Path Strategy: Root Templates</a>
        <li class="divider"></li>
      </ul>
    </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  </div>

  </div>

  <!-- Footer
  ================================================== -->
  <footer class="well">
    <div class="container">
      <div class="row">
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Main</li>
            <li >
              <a href="../../" title="Home">Home</a>
            </li>
            <li >
              <a href="../../platforms.html" title="Platforms">Platforms</a>
            </li>
            <li >
              <a href="../../maven.html" title="Maven Repositories">Maven Repositories</a>
            </li>
            <li >
              <a href="https://github.com/wcm-io" title="GitHub project" class="externalLink">GitHub project</a>
            </li>
            <li >
              <a href="../../subprojects.html" title="Subprojects">Subprojects</a>
            </li>
            <li >
              <a href="http://www.apache.org/licenses/LICENSE-2.0.txt" title="License" class="externalLink">License</a>
            </li>
            <li >
              <a href="../../commercial-support.html" title="Commercial Support">Commercial Support</a>
            </li>
            <li >
              <a href="https://diva-e.com/en/imprint/" title="Imprint" class="externalLink">Imprint</a>
            </li>
            <li >
              <a href="../../privacy.html" title="Privacy Policy">Privacy Policy</a>
            </li>
          </ul>
        </div>
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Categories</li>
            <li >
              <a href="../../wcm/" title="WCM">WCM</a>
            </li>
            <li >
              <a href="../" title="Context-Aware Configuration">Context-Aware Configuration</a>
            </li>
            <li >
              <a href="../../handler/" title="Handler">Handler</a>
            </li>
            <li >
              <a href="../../sling/" title="Sling Extensions">Sling Extensions</a>
            </li>
            <li >
              <a href="../../testing/" title="Testing">Testing</a>
            </li>
            <li >
              <a href="../../samples/" title="Samples">Samples</a>
            </li>
            <li >
              <a href="../../tooling/" title="Tooling">Tooling</a>
            </li>
          </ul>
        </div>
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Contribute</li>
            <li >
              <a href="../../contribute.html" title="Contribute">Contribute</a>
            </li>
            <li >
              <a href="../../manifest.html" title="Manifest">Manifest</a>
            </li>
            <li >
              <a href="https://github.com/wcm-io" title="Issues" class="externalLink">Issues</a>
            </li>
            <li >
              <a href="https://wcm-io.atlassian.net/wiki/" title="Wiki" class="externalLink">Wiki</a>
            </li>
            <li >
              <a href="../../mailing-lists.html" title="Mailing Lists">Mailing Lists</a>
            </li>
            <li >
              <a href="https://github.com/wcm-io" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
            </li>
          </ul>
        </div>
        <div class="span3 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Maven documentation</li>
            <li >
              <a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
            </li>
            <li >
              <a href="project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
            </li>
          </ul>
        </div>
        <div class="span3 bottom-description">
          <blockquote>wcm.io is an Open Source project which provides libraries and extensions for AEM-based applications.</blockquote>
        </div>
      </div>
    </div>
  </footer>

  <div class="container subfooter">
    <div class="row">
      <div class="span12">
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p class="copyright">Copyright &copy;2014-2024 <a href="https://wcm.io">wcm.io</a>. All Rights Reserved.</p>
        <p class="version-date"><span class="projectVersion">Version: 1.9.5-SNAPSHOT. </span><span class="publishDate">Last Published: 2024-07-01. </span></p>
      </div>
    </div>
  </div>

  <!-- JavaScript
  ================================================== -->
  <script src="https://wcm.io/js/jquery.min.js"></script>
  <script src="https://wcm.io/js/bootstrap.min.js"></script>
  <script src="https://wcm.io/js/lightbox.min.js"></script>
  <script src="https://wcm.io/js/reflow-scroll.js"></script>
  <script src="https://wcm.io/js/json5.min.js"></script>
  <script src="https://wcm.io/js/reflow-json-jcr-convert.js"></script>
  <script src="https://wcm.io/js/highlight.min.js"></script>


  <script src="https://wcm.io/js/reflow-skin.js"></script>

  </body>
</html>