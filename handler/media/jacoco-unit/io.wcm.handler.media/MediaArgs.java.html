<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MediaArgs.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Media Handler</a> &gt; <a href="index.source.html" class="el_package">io.wcm.handler.media</a> &gt; <span class="el_source">MediaArgs.java</span></div><h1>MediaArgs.java</h1><pre class="source lang-java linenums">/*
 * #%L
 * wcm.io
 * %%
 * Copyright (C) 2014 wcm.io
 * %%
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * #L%
 */
package io.wcm.handler.media;

import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;

import org.apache.commons.lang3.ArrayUtils;
import org.apache.commons.lang3.builder.EqualsBuilder;
import org.apache.commons.lang3.builder.HashCodeBuilder;
import org.apache.commons.lang3.builder.ToStringBuilder;
import org.apache.sling.api.resource.ValueMap;
import org.apache.sling.api.wrappers.ValueMapDecorator;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.annotations.Nullable;
import org.osgi.annotation.versioning.ProviderType;

import io.wcm.handler.media.format.MediaFormat;
import io.wcm.handler.media.markup.DragDropSupport;
import io.wcm.handler.media.markup.IPERatioCustomize;
import io.wcm.handler.url.UrlMode;
import io.wcm.wcm.commons.util.ToStringStyle;

/**
 * Holds parameters to influence the media resolving process.
 */
@ProviderType
public final class MediaArgs implements Cloneable {

  private MediaFormatOption[] mediaFormatOptions;
  private boolean autoCrop;
  private String[] fileExtensions;
  private UrlMode urlMode;
  private long fixedWidth;
  private long fixedHeight;
  private boolean download;
  private boolean contentDispositionAttachment;
  private String altText;
<span class="fc" id="L57">  private boolean altValueFromDam = true;</span>
  private boolean decorative;
<span class="fc" id="L59">  private boolean dummyImage = true;</span>
  private String dummyImageUrl;
  private boolean includeAssetThumbnails;
  private Boolean includeAssetWebRenditions;
  private ImageSizes imageSizes;
  private PictureSource[] pictureSourceSets;
<span class="fc" id="L65">  private DragDropSupport dragDropSupport = DragDropSupport.AUTO;</span>
<span class="fc" id="L66">  private IPERatioCustomize ipeRatioCustomize = IPERatioCustomize.AUTO;</span>
  private boolean dynamicMediaDisabled;
  private ValueMap properties;

  /**
   * Default constructor
   */
<span class="fc" id="L73">  public MediaArgs() {</span>
    // default constructor
<span class="fc" id="L75">  }</span>

  /**
   * @param mediaFormats Media formats
   */
  @SuppressWarnings(&quot;null&quot;)
<span class="fc" id="L81">  public MediaArgs(@NotNull MediaFormat @NotNull... mediaFormats) {</span>
<span class="fc" id="L82">    mediaFormats(mediaFormats);</span>
<span class="fc" id="L83">  }</span>

  /**
   * @param mediaFormatNames Media format names
   */
<span class="fc" id="L88">  public MediaArgs(@NotNull String @NotNull... mediaFormatNames) {</span>
<span class="fc" id="L89">    mediaFormatNames(mediaFormatNames);</span>
<span class="fc" id="L90">  }</span>

  /**
   * Returns list of media formats to resolve to. If {@link #isMediaFormatsMandatory()} is false,
   * the first rendition that matches any of the given media format is returned. If it is set to true,
   * for each media format given a rendition has to be resolved and returned. If not all renditions
   * could be resolved the media is marked as invalid (but the partial resolved renditions are returned anyway).
   * @return Media formats
   */
  public MediaFormat[] getMediaFormats() {
<span class="fc bfc" id="L100" title="All 2 branches covered.">    if (this.mediaFormatOptions != null) {</span>
<span class="fc" id="L101">      MediaFormat[] result = Arrays.stream(this.mediaFormatOptions)</span>
<span class="pc bpc" id="L102" title="1 of 2 branches missed.">          .filter(option -&gt; option.getMediaFormatName() == null)</span>
<span class="fc" id="L103">          .map(option -&gt; option.getMediaFormat())</span>
<span class="fc" id="L104">          .toArray(size -&gt; new MediaFormat[size]);</span>
<span class="pc bpc" id="L105" title="1 of 2 branches missed.">      if (result.length &gt; 0) {</span>
<span class="fc" id="L106">        return result;</span>
      }
    }
<span class="fc" id="L109">    return null;</span>
  }

  /**
   * Sets list of media formats to resolve to.
   * @param values Media formats
   * @return this
   */
  public @NotNull MediaArgs mediaFormats(@Nullable MediaFormat @Nullable... values) {
<span class="pc bpc" id="L118" title="2 of 4 branches missed.">    if (values == null || values.length == 0) {</span>
<span class="nc" id="L119">      this.mediaFormatOptions = null;</span>
    }
    else {
<span class="fc" id="L122">      this.mediaFormatOptions = Arrays.stream(values)</span>
<span class="fc" id="L123">          .map(mediaFormat -&gt; new MediaFormatOption(mediaFormat, false))</span>
<span class="fc" id="L124">          .toArray(size -&gt; new MediaFormatOption[size]);</span>
    }
<span class="fc" id="L126">    return this;</span>
  }

  /**
   * Sets list of media formats to resolve to.
   * Additionally {@link #isMediaFormatsMandatory()} is set to true.
   * @param values Media formats
   * @return this
   */
  public @NotNull MediaArgs mandatoryMediaFormats(@NotNull MediaFormat @Nullable... values) {
<span class="pc bpc" id="L136" title="2 of 4 branches missed.">    if (values == null || values.length == 0) {</span>
<span class="nc" id="L137">      this.mediaFormatOptions = null;</span>
    }
    else {
<span class="fc" id="L140">      this.mediaFormatOptions = Arrays.stream(values)</span>
<span class="fc" id="L141">          .map(mediaFormat -&gt; new MediaFormatOption(mediaFormat, true))</span>
<span class="fc" id="L142">          .toArray(size -&gt; new MediaFormatOption[size]);</span>
    }
<span class="fc" id="L144">    return this;</span>
  }

  /**
   * Sets a single media format to resolve to.
   * @param value Media format
   * @return this
   */
  public @NotNull MediaArgs mediaFormat(MediaFormat value) {
<span class="fc bfc" id="L153" title="All 2 branches covered.">    if (value == null) {</span>
<span class="fc" id="L154">      this.mediaFormatOptions = null;</span>
    }
    else {
<span class="fc" id="L157">      this.mediaFormatOptions = new MediaFormatOption[] {</span>
          new MediaFormatOption(value, false)
      };
    }
<span class="fc" id="L161">    return this;</span>
  }

  /**
   * Checks if all media format options have the &quot;mandatory&quot; flag set.
   * If none or not all of them have the flag set, false is returned.
   * @return true if all media format options have the &quot;mandatory&quot; flag set.
   * @deprecated Please check the mandatory flag for each media format individually via {@link #getMediaFormatOptions()}
   */
  @Deprecated
  public boolean isMediaFormatsMandatory() {
<span class="fc bfc" id="L172" title="All 2 branches covered.">    if (this.mediaFormatOptions == null) {</span>
<span class="fc" id="L173">      return false;</span>
    }
<span class="fc" id="L175">    return !Arrays.stream(this.mediaFormatOptions)</span>
<span class="fc bfc" id="L176" title="All 2 branches covered.">        .filter(option -&gt; !option.isMandatory())</span>
<span class="fc bfc" id="L177" title="All 2 branches covered.">        .findFirst().isPresent();</span>
  }

  /**
   * The &quot;mandatory&quot; flag of all media format options is set to to the given value.
   * @param value Resolving of all media formats is mandatory.
   * @return this
   */
  public @NotNull MediaArgs mediaFormatsMandatory(boolean value) {
<span class="nc bnc" id="L186" title="All 2 branches missed.">    if (this.mediaFormatOptions != null) {</span>
<span class="nc" id="L187">      this.mediaFormatOptions = Arrays.stream(this.mediaFormatOptions)</span>
<span class="nc" id="L188">          .map(option -&gt; option.withMandatory(value))</span>
<span class="nc" id="L189">          .toArray(size -&gt; new MediaFormatOption[size]);</span>
    }
<span class="nc" id="L191">    return this;</span>
  }

  /**
   * Returns list of media formats to resolve to. See {@link #getMediaFormatNames()} for details.
   * @return Media format names
   */
  public String[] getMediaFormatNames() {
<span class="fc bfc" id="L199" title="All 2 branches covered.">    if (this.mediaFormatOptions != null) {</span>
<span class="fc" id="L200">      String[] result = Arrays.stream(this.mediaFormatOptions)</span>
<span class="fc bfc" id="L201" title="All 2 branches covered.">          .filter(option -&gt; option.getMediaFormatName() != null)</span>
<span class="fc" id="L202">          .map(option -&gt; option.getMediaFormatName())</span>
<span class="fc" id="L203">          .toArray(size -&gt; new String[size]);</span>
<span class="fc bfc" id="L204" title="All 2 branches covered.">      if (result.length &gt; 0) {</span>
<span class="fc" id="L205">        return result;</span>
      }
    }
<span class="fc" id="L208">    return null;</span>
  }

  /**
   * Sets list of media formats to resolve to.
   * @param names Media format names.
   * @return this
   */
  public @NotNull MediaArgs mediaFormatNames(@NotNull String @Nullable... names) {
<span class="pc bpc" id="L217" title="2 of 4 branches missed.">    if (names == null || names.length == 0) {</span>
<span class="nc" id="L218">      this.mediaFormatOptions = null;</span>
    }
    else {
<span class="fc" id="L221">      this.mediaFormatOptions = Arrays.stream(names)</span>
<span class="fc" id="L222">          .map(name -&gt; new MediaFormatOption(name, false))</span>
<span class="fc" id="L223">          .toArray(size -&gt; new MediaFormatOption[size]);</span>
    }
<span class="fc" id="L225">    return this;</span>
  }

  /**
   * Sets list of media formats to resolve to.
   * Additionally {@link #isMediaFormatsMandatory()} is set to true.
   * @param names Media format names.
   * @return this
   */
  public @NotNull MediaArgs mandatoryMediaFormatNames(@NotNull String @Nullable... names) {
<span class="pc bpc" id="L235" title="2 of 4 branches missed.">    if (names == null || names.length == 0) {</span>
<span class="nc" id="L236">      this.mediaFormatOptions = null;</span>
    }
    else {
<span class="fc" id="L239">      this.mediaFormatOptions = Arrays.stream(names)</span>
<span class="fc" id="L240">          .map(name -&gt; new MediaFormatOption(name, true))</span>
<span class="fc" id="L241">          .toArray(size -&gt; new MediaFormatOption[size]);</span>
    }
<span class="fc" id="L243">    return this;</span>
  }

  /**
   * Sets a single media format to resolve to.
   * @param name Media format name
   * @return this
   */
  public @NotNull MediaArgs mediaFormatName(String name) {
<span class="fc bfc" id="L252" title="All 2 branches covered.">    if (name == null) {</span>
<span class="fc" id="L253">      this.mediaFormatOptions = null;</span>
    }
    else {
<span class="fc" id="L256">      this.mediaFormatOptions = new MediaFormatOption[] {</span>
          new MediaFormatOption(name, false)
      };
    }
<span class="fc" id="L260">    return this;</span>
  }

  /**
   * Gets list of media formats to resolve to.
   * @return Media formats with mandatory flag
   */
  public MediaFormatOption[] getMediaFormatOptions() {
<span class="fc" id="L268">    return this.mediaFormatOptions;</span>
  }

  /**
   * Sets list of media formats to resolve to.
   * @param values Media formats with mandatory flag
   * @return this
   */
  public @NotNull MediaArgs mediaFormatOptions(@NotNull MediaFormatOption @Nullable... values) {
<span class="pc bpc" id="L277" title="1 of 4 branches missed.">    if (values == null || values.length == 0) {</span>
<span class="fc" id="L278">      this.mediaFormatOptions = null;</span>
    }
    else {
<span class="fc" id="L281">      this.mediaFormatOptions = values;</span>
    }
<span class="fc" id="L283">    return this;</span>
  }

  /**
   * @return Enables &quot;auto-cropping&quot; mode. If no matching rendition is found
   *         it is tried to generate one by automatically cropping another one.
   */
  public boolean isAutoCrop() {
<span class="fc" id="L291">    return this.autoCrop;</span>
  }

  /**
   * @param value Enables &quot;auto-cropping&quot; mode. If no matching rendition is found
   *          it is tried to generate one by automatically cropping another one.
   * @return this
   */
  public @NotNull MediaArgs autoCrop(boolean value) {
<span class="fc" id="L300">    this.autoCrop = value;</span>
<span class="fc" id="L301">    return this;</span>
  }

  /**
   * @return File extensions
   */
  public String[] getFileExtensions() {
<span class="fc" id="L308">    return this.fileExtensions;</span>
  }

  /**
   * @param values File extensions
   * @return this
   */
  public @NotNull MediaArgs fileExtensions(@NotNull String @Nullable... values) {
<span class="pc bpc" id="L316" title="2 of 4 branches missed.">    if (values == null || values.length == 0) {</span>
<span class="nc" id="L317">      this.fileExtensions = null;</span>
    }
    else {
<span class="fc" id="L320">      this.fileExtensions = values;</span>
    }
<span class="fc" id="L322">    return this;</span>
  }

  /**
   * @param value File extension
   * @return this
   */
  public @NotNull MediaArgs fileExtension(String value) {
<span class="fc bfc" id="L330" title="All 2 branches covered.">    if (value == null) {</span>
<span class="fc" id="L331">      this.fileExtensions = null;</span>
    }
    else {
<span class="fc" id="L334">      this.fileExtensions = new String[] {</span>
          value
      };
    }
<span class="fc" id="L338">    return this;</span>
  }

  /**
   * @return URL mode
   */
  public UrlMode getUrlMode() {
<span class="fc" id="L345">    return this.urlMode;</span>
  }

  /**
   * @param value URS mode
   * @return this
   */
  public @NotNull MediaArgs urlMode(UrlMode value) {
<span class="fc" id="L353">    this.urlMode = value;</span>
<span class="fc" id="L354">    return this;</span>
  }

  /**
   * Use fixed width instead of width from media format or original image
   * @return Fixed width
   */
  public long getFixedWidth() {
<span class="fc" id="L362">    return this.fixedWidth;</span>
  }

  /**
   * Use fixed width instead of width from media format or original image
   * @param value Fixed width
   * @return this
   */
  public @NotNull MediaArgs fixedWidth(long value) {
<span class="fc" id="L371">    this.fixedWidth = value;</span>
<span class="fc" id="L372">    return this;</span>
  }

  /**
   * Use fixed height instead of width from media format or original image
   * @return Fixed height
   */
  public long getFixedHeight() {
<span class="fc" id="L380">    return this.fixedHeight;</span>
  }

  /**
   * Use fixed height instead of width from media format or original image
   * @param value Fixed height
   * @return this
   */
  public @NotNull MediaArgs fixedHeight(long value) {
<span class="fc" id="L389">    this.fixedHeight = value;</span>
<span class="fc" id="L390">    return this;</span>
  }

  /**
   * Use fixed dimensions instead of width from media format or original image
   * @param widthValue Fixed width
   * @param heightValue Fixed height
   * @return this
   */
  public @NotNull MediaArgs fixedDimension(long widthValue, long heightValue) {
<span class="fc" id="L400">    this.fixedWidth = widthValue;</span>
<span class="fc" id="L401">    this.fixedHeight = heightValue;</span>
<span class="fc" id="L402">    return this;</span>
  }

  /**
   * @return Accept only media formats that have the download flag set.
   */
  public boolean isDownload() {
<span class="fc" id="L409">    return this.download;</span>
  }

  /**
   * @param value Accept only media formats that have the download flag set.
   * @return this
   */
  public @NotNull MediaArgs download(boolean value) {
<span class="fc" id="L417">    this.download = value;</span>
<span class="fc" id="L418">    return this;</span>
  }

  /**
   * @return Whether to set a &quot;Content-Disposition&quot; header to &quot;attachment&quot; for forcing a &quot;Save as&quot; dialog on the client
   */
  public boolean isContentDispositionAttachment() {
<span class="fc" id="L425">    return this.contentDispositionAttachment;</span>
  }

  /**
   * @param value Whether to set a &quot;Content-Disposition&quot; header to &quot;attachment&quot; for forcing a &quot;Save as&quot; dialog on the
   *          client
   * @return this
   */
  public @NotNull MediaArgs contentDispositionAttachment(boolean value) {
<span class="fc" id="L434">    this.contentDispositionAttachment = value;</span>
<span class="fc" id="L435">    return this;</span>
  }

  /**
   * @return The custom alternative text that is to be used instead of the one defined in the the asset metadata.
   */
  public String getAltText() {
<span class="fc" id="L442">    return this.altText;</span>
  }

  /**
   * Allows to specify a custom alternative text that is to be used instead of the one defined in the the asset
   * metadata.
   * @param value Custom alternative text. If null or empty, the default alt text from media library is used.
   * @return this
   */
  public @NotNull MediaArgs altText(String value) {
<span class="fc" id="L452">    this.altText = value;</span>
<span class="fc" id="L453">    return this;</span>
  }

  /**
   * @return Whether to read alt. text from DAM asset if non custom alt. text is defined. Default to true.
   */
  public boolean isAltValueFromDam() {
<span class="fc" id="L460">    return this.altValueFromDam;</span>
  }

  /**
   * @param value Whether to read alt. text from DAM asset if non custom alt. text is defined. Default to true.
   * @return this
   */
  public @NotNull MediaArgs altValueFromDam(boolean value) {
<span class="fc" id="L468">    this.altValueFromDam = value;</span>
<span class="fc" id="L469">    return this;</span>
  }

  /**
   * @return Marks this image as &quot;decorative&quot;. Alt. text is then explicitly set to an empty string.
   */
  public boolean isDecorative() {
<span class="fc" id="L476">    return this.decorative;</span>
  }

  /**
   * @param value Marks this image as &quot;decorative&quot;. Alt. text is then explicitly set to an empty string.
   * @return this
   */
  public @NotNull MediaArgs decorative(boolean value) {
<span class="fc" id="L484">    this.decorative = value;</span>
<span class="fc" id="L485">    return this;</span>
  }

  /**
   * @return If set to true, media handler never returns a dummy image. Otherwise this can happen in edit mode.
   */
  public boolean isDummyImage() {
<span class="fc" id="L492">    return this.dummyImage;</span>
  }

  /**
   * @param value If set to false, media handler never returns a dummy image. Otherwise this can happen in edit mode.
   * @return this
   */
  public @NotNull MediaArgs dummyImage(boolean value) {
<span class="fc" id="L500">    this.dummyImage = value;</span>
<span class="fc" id="L501">    return this;</span>
  }

  /**
   * @return Url of custom dummy image. If null default dummy image is used.
   */
  public String getDummyImageUrl() {
<span class="fc" id="L508">    return this.dummyImageUrl;</span>
  }

  /**
   * @param value Url of custom dummy image. If null default dummy image is used.
   * @return this
   */
  public @NotNull MediaArgs dummyImageUrl(String value) {
<span class="fc" id="L516">    this.dummyImageUrl = value;</span>
<span class="fc" id="L517">    return this;</span>
  }

  /**
   * @return If set to true, thumbnail generated by the DAM asset workflows (with cq5dam.thumbnail prefix) are taken
   *         into account as well when trying to resolve the media request.
   */
  public boolean isIncludeAssetThumbnails() {
<span class="fc" id="L525">    return this.includeAssetThumbnails;</span>
  }

  /**
   * @param value If set to true, thumbnail generated by the DAM asset workflows (with cq5dam.thumbnail prefix) are
   *          taken into account as well when trying to resolve the media request.
   * @return this
   */
  public @NotNull MediaArgs includeAssetThumbnails(boolean value) {
<span class="fc" id="L534">    this.includeAssetThumbnails = value;</span>
<span class="fc" id="L535">    return this;</span>
  }

  /**
   * @return If set to true, web renditions generated by the DAM asset workflows (with cq5dam.web prefix) are taken
   *         into account as well when trying to resolve the media request.
   *         If null, the default setting applies from the media handler configuration.
   */
  public Boolean isIncludeAssetWebRenditions() {
<span class="fc" id="L544">    return this.includeAssetWebRenditions;</span>
  }

  /**
   * @param value If set to true, web renditions generated by the DAM asset workflows (with cq5dam.web prefix) are
   *          taken into account as well when trying to resolve the media request.
   * @return this
   */
  public @NotNull MediaArgs includeAssetWebRenditions(boolean value) {
<span class="fc" id="L553">    this.includeAssetWebRenditions = value;</span>
<span class="fc" id="L554">    return this;</span>
  }

  /**
   * @return Image sizes for responsive image handling
   */
  public ImageSizes getImageSizes() {
<span class="fc" id="L561">    return this.imageSizes;</span>
  }

  /**
   * @param value Image sizes for responsive image handling
   * @return this
   */
  public @NotNull MediaArgs imageSizes(ImageSizes value) {
<span class="fc" id="L569">    this.imageSizes = value;</span>
<span class="fc" id="L570">    return this;</span>
  }

  /**
   * @return Picture sources for responsive image handling
   */
  public PictureSource[] getPictureSources() {
<span class="fc" id="L577">    return this.pictureSourceSets;</span>
  }

  /**
   * @param value Picture sources for responsive image handling
   * @return this
   */
  public @NotNull MediaArgs pictureSources(@NotNull PictureSource @Nullable... value) {
<span class="fc" id="L585">    this.pictureSourceSets = value;</span>
<span class="fc" id="L586">    return this;</span>
  }

  /**
   * @return If set to true, dynamic media support is disabled even when enabled on the instance.
   */
  public boolean isDynamicMediaDisabled() {
<span class="fc" id="L593">    return this.dynamicMediaDisabled;</span>
  }

  /**
   * @param value If set to true, dynamic media support is disabled even when enabled on the instance.
   * @return this
   */
  public @NotNull MediaArgs dynamicMediaDisabled(boolean value) {
<span class="fc" id="L601">    this.dynamicMediaDisabled = value;</span>
<span class="fc" id="L602">    return this;</span>
  }

  /**
   * Drag&amp;amp;Drop support for media builder.
   * @return Drag&amp;amp;Drop support
   */
  public DragDropSupport getDragDropSupport() {
<span class="fc" id="L610">    return this.dragDropSupport;</span>
  }

  /**
   * Drag&amp;amp;Drop support for media builder.
   * @param value Drag&amp;amp;Drop support
   * @return this
   */
  public @NotNull MediaArgs dragDropSupport(DragDropSupport value) {
<span class="pc bpc" id="L619" title="1 of 2 branches missed.">    if (value == null) {</span>
<span class="nc" id="L620">      throw new IllegalArgumentException(&quot;No null value allowed for drag&amp;drop support.&quot;);</span>
    }
<span class="fc" id="L622">    this.dragDropSupport = value;</span>
<span class="fc" id="L623">    return this;</span>
  }

  /**
   * @return Whether to set customized list of IPE cropping ratios.
   */
  public IPERatioCustomize getIPERatioCustomize() {
<span class="fc" id="L630">    return this.ipeRatioCustomize;</span>
  }

  /**
   * @param value Whether to set customized list of IPE cropping ratios.
   * @return this
   */
  public @NotNull MediaArgs ipeRatioCustomize(IPERatioCustomize value) {
<span class="fc" id="L638">    this.ipeRatioCustomize = value;</span>
<span class="fc" id="L639">    return this;</span>
  }

  /**
   * Custom properties that my be used by application-specific markup builders or processors.
   * @param map Property map. Is merged with properties already set.
   * @return this
   */
  public @NotNull MediaArgs properties(Map&lt;String, Object&gt; map) {
<span class="pc bpc" id="L648" title="1 of 2 branches missed.">    if (map == null) {</span>
<span class="nc" id="L649">      throw new IllegalArgumentException(&quot;Map argument must not be null.&quot;);</span>
    }
<span class="fc" id="L651">    getProperties().putAll(map);</span>
<span class="fc" id="L652">    return this;</span>
  }

  /**
   * Custom properties that my be used by application-specific markup builders or processors.
   * @param key Property key
   * @param value Property value
   * @return this
   */
  public @NotNull MediaArgs property(String key, Object value) {
<span class="pc bpc" id="L662" title="1 of 2 branches missed.">    if (key == null) {</span>
<span class="nc" id="L663">      throw new IllegalArgumentException(&quot;Key argument must not be null.&quot;);</span>
    }
<span class="fc" id="L665">    getProperties().put(key, value);</span>
<span class="fc" id="L666">    return this;</span>
  }

  /**
   * Custom properties that my be used by application-specific markup builders or processors.
   * @return Value map
   */
  @NotNull
  public ValueMap getProperties() {
<span class="fc bfc" id="L675" title="All 2 branches covered.">    if (this.properties == null) {</span>
<span class="fc" id="L676">      this.properties = new ValueMapDecorator(new HashMap&lt;String, Object&gt;());</span>
    }
<span class="fc" id="L678">    return this.properties;</span>
  }

  @Override
  public int hashCode() {
<span class="fc" id="L683">    return HashCodeBuilder.reflectionHashCode(this);</span>
  }

  @Override
  public boolean equals(Object obj) {
<span class="fc" id="L688">    return EqualsBuilder.reflectionEquals(this, obj);</span>
  }

  @Override
  public String toString() {
<span class="fc" id="L693">    return ToStringBuilder.reflectionToString(this, ToStringStyle.SHORT_PREFIX_OMIT_NULL_STYLE);</span>
  }

  /**
   * Custom clone-method for {@link MediaArgs}
   * @return the cloned {@link MediaArgs}
   */
  // CHECKSTYLE:OFF
  @Override
  public MediaArgs clone() { //NOPMD
    // CHECKSTYLE:ON
<span class="fc" id="L704">    MediaArgs clone = new MediaArgs();</span>

<span class="fc" id="L706">    clone.mediaFormatOptions = ArrayUtils.clone(this.mediaFormatOptions);</span>
<span class="fc" id="L707">    clone.autoCrop = this.autoCrop;</span>
<span class="fc" id="L708">    clone.fileExtensions = ArrayUtils.clone(this.fileExtensions);</span>
<span class="fc" id="L709">    clone.urlMode = this.urlMode;</span>
<span class="fc" id="L710">    clone.fixedWidth = this.fixedWidth;</span>
<span class="fc" id="L711">    clone.fixedHeight = this.fixedHeight;</span>
<span class="fc" id="L712">    clone.download = this.download;</span>
<span class="fc" id="L713">    clone.contentDispositionAttachment = this.contentDispositionAttachment;</span>
<span class="fc" id="L714">    clone.altText = this.altText;</span>
<span class="fc" id="L715">    clone.altValueFromDam = this.altValueFromDam;</span>
<span class="fc" id="L716">    clone.decorative = this.decorative;</span>
<span class="fc" id="L717">    clone.dummyImage = this.dummyImage;</span>
<span class="fc" id="L718">    clone.dummyImageUrl = this.dummyImageUrl;</span>
<span class="fc" id="L719">    clone.includeAssetThumbnails = this.includeAssetThumbnails;</span>
<span class="fc" id="L720">    clone.includeAssetWebRenditions = this.includeAssetWebRenditions;</span>
<span class="fc" id="L721">    clone.imageSizes = this.imageSizes;</span>
<span class="fc" id="L722">    clone.pictureSourceSets = ArrayUtils.clone(this.pictureSourceSets);</span>
<span class="fc" id="L723">    clone.dragDropSupport = this.dragDropSupport;</span>
<span class="fc" id="L724">    clone.ipeRatioCustomize = this.ipeRatioCustomize;</span>
<span class="fc" id="L725">    clone.dynamicMediaDisabled = this.dynamicMediaDisabled;</span>
<span class="fc bfc" id="L726" title="All 2 branches covered.">    if (this.properties != null) {</span>
<span class="fc" id="L727">      clone.properties = new ValueMapDecorator(new HashMap&lt;String, Object&gt;(this.properties));</span>
    }

<span class="fc" id="L730">    return clone;</span>
  }

  /**
   * Media format to be applied on media processing.
   */
  @ProviderType
  public static final class MediaFormatOption {

    private final MediaFormat mediaFormat;
    private final String mediaFormatName;
    private final boolean mandatory;

    /**
     * @param mediaFormat Media format
     * @param mandatory Resolution of this media format is mandatory
     */
<span class="fc" id="L747">    public MediaFormatOption(@Nullable MediaFormat mediaFormat, boolean mandatory) {</span>
<span class="fc" id="L748">      this.mediaFormat = mediaFormat;</span>
<span class="fc" id="L749">      this.mediaFormatName = null;</span>
<span class="fc" id="L750">      this.mandatory = mandatory;</span>
<span class="fc" id="L751">    }</span>

    /**
     * @param mediaFormatName Media format name
     * @param mandatory Resolution of this media format is mandatory
     */
<span class="fc" id="L757">    public MediaFormatOption(@NotNull String mediaFormatName, boolean mandatory) {</span>
<span class="fc" id="L758">      this.mediaFormat = null;</span>
<span class="fc" id="L759">      this.mediaFormatName = mediaFormatName;</span>
<span class="fc" id="L760">      this.mandatory = mandatory;</span>
<span class="fc" id="L761">    }</span>

    public @Nullable MediaFormat getMediaFormat() {
<span class="fc" id="L764">      return this.mediaFormat;</span>
    }

    public @Nullable String getMediaFormatName() {
<span class="fc" id="L768">      return this.mediaFormatName;</span>
    }

    public boolean isMandatory() {
<span class="fc" id="L772">      return this.mandatory;</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L777">      return HashCodeBuilder.reflectionHashCode(this);</span>
    }

    @Override
    public boolean equals(Object obj) {
<span class="fc" id="L782">      return EqualsBuilder.reflectionEquals(this, obj);</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L787">      return ToStringBuilder.reflectionToString(this, ToStringStyle.SHORT_PREFIX_OMIT_NULL_STYLE);</span>
    }

    @NotNull
    MediaFormatOption withMandatory(boolean newMandatory) {
<span class="nc bnc" id="L792" title="All 2 branches missed.">      if (this.mediaFormat != null) {</span>
<span class="nc" id="L793">        return new MediaFormatOption(this.mediaFormat, newMandatory);</span>
      }
      else {
<span class="nc" id="L796">        return new MediaFormatOption(this.mediaFormatName, newMandatory);</span>
      }
    }

  }

  /**
   * Image sizes for responsive image handling.
   */
  @ProviderType
  public static final class ImageSizes {

    private final @NotNull String sizes;
    private final @NotNull WidthOption @NotNull [] widthOptions;

    /**
     * @param sizes A &lt;a href=&quot;http://w3c.github.io/html/semantics-embedded-content.html#valid-source-size-list&quot;&gt;valid
     *          source size list&lt;/a&gt;
     * @param widths Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute (all mandatory).
     */
<span class="fc" id="L816">    public ImageSizes(@NotNull String sizes, long @NotNull... widths) {</span>
<span class="fc" id="L817">      this.sizes = sizes;</span>
<span class="fc" id="L818">      this.widthOptions = Arrays.stream(widths)</span>
<span class="fc" id="L819">          .mapToObj(width -&gt; new WidthOption(width, true))</span>
<span class="fc" id="L820">          .toArray(size -&gt; new WidthOption[size]);</span>
<span class="fc" id="L821">    }</span>

    /**
     * @param sizes A &lt;a href=&quot;http://w3c.github.io/html/semantics-embedded-content.html#valid-source-size-list&quot;&gt;valid
     *          source size list&lt;/a&gt;
     * @param widthOptions Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute.
     */
<span class="fc" id="L828">    public ImageSizes(@NotNull String sizes, @NotNull WidthOption @NotNull... widthOptions) {</span>
<span class="fc" id="L829">      this.sizes = sizes;</span>
<span class="fc" id="L830">      this.widthOptions = widthOptions;</span>
<span class="fc" id="L831">    }</span>

    /**
     * @return A &lt;a href=&quot;http://w3c.github.io/html/semantics-embedded-content.html#valid-source-size-list&quot;&gt;valid
     *         source size list&lt;/a&gt;
     */
    public @NotNull String getSizes() {
<span class="fc" id="L838">      return this.sizes;</span>
    }

    /**
     * @return Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute.
     * @deprecated Use {@link #getWidthOptions()}
     */
    @Deprecated
    public long @Nullable [] getWidths() {
<span class="nc" id="L847">      return Arrays.stream(this.widthOptions)</span>
<span class="nc" id="L848">          .mapToLong(WidthOption::getWidth)</span>
<span class="nc" id="L849">          .toArray();</span>
    }

    /**
     * @return Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute.
     */
    public @NotNull WidthOption @Nullable [] getWidthOptions() {
<span class="fc" id="L856">      return this.widthOptions;</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L861">      return HashCodeBuilder.reflectionHashCode(this);</span>
    }

    @Override
    public boolean equals(Object obj) {
<span class="fc" id="L866">      return EqualsBuilder.reflectionEquals(this, obj);</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L871">      return ToStringBuilder.reflectionToString(this, ToStringStyle.SHORT_PREFIX_OMIT_NULL_STYLE);</span>
    }

  }

  /**
   * Picture source for responsive image handling.
   */
  @ProviderType
  public static final class PictureSource {

    private MediaFormat mediaFormat;
    private String mediaFormatName;
    private String media;
    private String sizes;
    private WidthOption[] widthOptions;

    /**
     * @param mediaFormat Media format
     */
<span class="fc" id="L891">    public PictureSource(@NotNull MediaFormat mediaFormat) {</span>
<span class="fc" id="L892">      this.mediaFormat = mediaFormat;</span>
<span class="fc" id="L893">    }</span>

    /**
     * @param mediaFormatName Media format name
     */
<span class="fc" id="L898">    public PictureSource(@Nullable String mediaFormatName) {</span>
<span class="fc" id="L899">      this.mediaFormatName = mediaFormatName;</span>
<span class="fc" id="L900">    }</span>

    /**
     * @param mediaFormat Media format
     * @param media A &lt;a href=&quot;http://w3c.github.io/html/infrastructure.html#valid-media-query-list&quot;&gt;valid media query
     *          list&lt;/a&gt;
     * @param widths Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute (all mandatory).
     * @deprecated Use constructor with {@link MediaFormat} and {@link #media} and {@link #widths(long...)}.
     */
    @Deprecated
    public PictureSource(@NotNull MediaFormat mediaFormat, @Nullable String media,
<span class="nc" id="L911">        long @NotNull... widths) {</span>
<span class="nc" id="L912">      this.mediaFormat = mediaFormat;</span>
<span class="nc" id="L913">      this.media = media;</span>
<span class="nc" id="L914">      this.widthOptions = toWidthOptions(widths);</span>
<span class="nc" id="L915">    }</span>

    /**
     * @param mediaFormat Media format
     * @param media A &lt;a href=&quot;http://w3c.github.io/html/infrastructure.html#valid-media-query-list&quot;&gt;valid media query
     *          list&lt;/a&gt;
     * @param widthOptions Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute.
     * @deprecated Use constructor with {@link MediaFormat} and {@link #media} and {@link #widths(long...)}.
     */
    @Deprecated
    public PictureSource(@Nullable MediaFormat mediaFormat, @Nullable String media,
<span class="nc" id="L926">        @NotNull WidthOption @NotNull... widthOptions) {</span>
<span class="nc" id="L927">      this.mediaFormat = mediaFormat;</span>
<span class="nc" id="L928">      this.media = media;</span>
<span class="nc" id="L929">      this.widthOptions = widthOptions;</span>
<span class="nc" id="L930">    }</span>

    private static @NotNull WidthOption @NotNull [] toWidthOptions(long @NotNull... widths) {
<span class="fc" id="L933">      return Arrays.stream(widths)</span>
<span class="fc" id="L934">          .mapToObj(width -&gt; new WidthOption(width, true))</span>
<span class="fc" id="L935">          .toArray(size -&gt; new WidthOption[size]);</span>
    }

    /**
     * @return Media format
     */
    public @Nullable MediaFormat getMediaFormat() {
<span class="fc" id="L942">      return this.mediaFormat;</span>
    }

    /**
     * @return Media format
     */
    public @Nullable String getMediaFormatName() {
<span class="fc" id="L949">      return this.mediaFormatName;</span>
    }

    /**
     * @param value Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute.
     * @return this
     */
    public PictureSource widthOptions(@NotNull WidthOption @NotNull... value) {
<span class="fc" id="L957">      this.widthOptions = value;</span>
<span class="fc" id="L958">      return this;</span>
    }

    /**
     * @return Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute.
     */
    public @NotNull WidthOption @Nullable [] getWidthOptions() {
<span class="fc" id="L965">      return this.widthOptions;</span>
    }

    /**
     * @param value Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute.
     * @return this
     */
    public PictureSource widths(long @NotNull... value) {
<span class="fc" id="L973">      this.widthOptions = toWidthOptions(value);</span>
<span class="fc" id="L974">      return this;</span>
    }

    /**
     * @return Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute.
     * @deprecated Use {@link #getWidthOptions()}
     */
    @Deprecated
    public long @Nullable [] getWidths() {
<span class="nc" id="L983">      return Arrays.stream(this.widthOptions)</span>
<span class="nc" id="L984">          .mapToLong(WidthOption::getWidth)</span>
<span class="nc" id="L985">          .toArray();</span>
    }

    /**
     * @param value A &lt;a href=&quot;http://w3c.github.io/html/semantics-embedded-content.html#valid-source-size-list&quot;&gt;valid
     *          source size list&lt;/a&gt;.
     * @return this
     */
    public PictureSource sizes(@Nullable String value) {
<span class="fc" id="L994">      this.sizes = value;</span>
<span class="fc" id="L995">      return this;</span>
    }

    /**
     * @return A &lt;a href=&quot;http://w3c.github.io/html/semantics-embedded-content.html#valid-source-size-list&quot;&gt;valid source
     *         size list&lt;/a&gt;.
     */
    public @Nullable String getSizes() {
<span class="fc" id="L1003">      return this.sizes;</span>
    }

    /**
     * @param value A &lt;a href=&quot;http://w3c.github.io/html/infrastructure.html#valid-media-query-list&quot;&gt;valid media query
     *          list&lt;/a&gt;.
     * @return this
     */
    public PictureSource media(@Nullable String value) {
<span class="fc" id="L1012">      this.media = value;</span>
<span class="fc" id="L1013">      return this;</span>
    }

    /**
     * @return A &lt;a href=&quot;http://w3c.github.io/html/infrastructure.html#valid-media-query-list&quot;&gt;valid media query
     *         list&lt;/a&gt;.
     */
    public @Nullable String getMedia() {
<span class="fc" id="L1021">      return this.media;</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L1026">      return HashCodeBuilder.reflectionHashCode(this);</span>
    }

    @Override
    public boolean equals(Object obj) {
<span class="fc" id="L1031">      return EqualsBuilder.reflectionEquals(this, obj);</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L1036">      return ToStringBuilder.reflectionToString(this, ToStringStyle.SHORT_PREFIX_OMIT_NULL_STYLE);</span>
    }

  }

  /**
   * Width value with mandatory flag.
   */
  @ProviderType
  public static final class WidthOption {

    private final long width;
    private final boolean mandatory;

    /**
     * @param width Width value
     * @param mandatory Is it mandatory to resolve a rendition with this width
     */
<span class="fc" id="L1054">    public WidthOption(long width, boolean mandatory) {</span>
<span class="fc" id="L1055">      this.width = width;</span>
<span class="fc" id="L1056">      this.mandatory = mandatory;</span>
<span class="fc" id="L1057">    }</span>

    /**
     * @return Width value
     */
    public long getWidth() {
<span class="fc" id="L1063">      return this.width;</span>
    }

    /**
     * @return Is it mandatory to resolve a rendition with this width
     */
    public boolean isMandatory() {
<span class="fc" id="L1070">      return this.mandatory;</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L1075">      return HashCodeBuilder.reflectionHashCode(this);</span>
    }

    @Override
    public boolean equals(Object obj) {
<span class="fc" id="L1080">      return EqualsBuilder.reflectionEquals(this, obj);</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L1085">      return ToStringBuilder.reflectionToString(this, ToStringStyle.SHORT_PREFIX_OMIT_NULL_STYLE);</span>
    }

  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>