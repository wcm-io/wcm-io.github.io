
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2024-08-23
 Rendered using Reflow Maven Skin 1.2.0 (https://github.com/wcm-io/wcm-io-tooling/tree/develop/maven/skins/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

  <head>
    <meta charset="UTF-8" />
    <title>Media Handler System Configuration | wcm.io</title>

    <link rel="shortcut icon" href="https://wcm.io/images/favicon.ico">
    <link rel="apple-touch-icon" href="https://wcm.io/images/favicon-152.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="wcm.io - Libraries and extensions for AEM applications" />
    <meta http-equiv="content-language" content="en" />

    <link href="https://wcm.io/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://wcm.io/css/docs.css" rel="stylesheet" />
    <link href="https://wcm.io/css/reflow-skin.css" rel="stylesheet" />
    <link href="https://wcm.io/css/highlightjs-style-github.min.css" rel="stylesheet" />

    <link href="https://wcm.io/css/lightbox.css" rel="stylesheet" />

    <link href="https://wcm.io/css/site.css" rel="stylesheet" />
    <link href="https://wcm.io/css/print.css" rel="stylesheet" media="print" />


  </head>

  <body class="page-configuration project-io.wcm.handler.media" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../..">wcm.io</a>
          <div class="nav-collapse collapse" id="top-nav-collapse">
            <ul class="nav pull-right">
              <li ><a href="https://github.com/wcm-io" title="GitHub project" class="externalLink">GitHub project</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Categories <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li ><a href="../../wcm/" title="WCM">WCM</a></li>
                  <li ><a href="../../caconfig/" title="Context-Aware Configuration">Context-Aware Configuration</a></li>
                  <li ><a href="../" title="Handler">Handler</a></li>
                  <li ><a href="../../sling/" title="Sling Extensions">Sling Extensions</a></li>
                  <li ><a href="../../testing/" title="Testing">Testing</a></li>
                  <li ><a href="../../samples/" title="Samples">Samples</a></li>
                  <li ><a href="../../tooling/" title="Tooling">Tooling</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contribute <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li ><a href="../../contribute.html" title="Contribute">Contribute</a></li>
                  <li ><a href="../../manifest.html" title="Manifest">Manifest</a></li>
                  <li ><a href="https://github.com/wcm-io" title="Issues" class="externalLink">Issues</a></li>
                  <li ><a href="https://wcm-io.atlassian.net/wiki/" title="Wiki" class="externalLink">Wiki</a></li>
                  <li ><a href="../../mailing-lists.html" title="Mailing Lists">Mailing Lists</a></li>
                  <li ><a href="https://github.com/wcm-io" title="Fork on GitHub" class="externalLink">Fork on GitHub</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

  <div class="container">

  <!-- Masthead
  ================================================== -->

  <header>
  <div class="jumbotron subhead">
    <div class="row" id="banner">
      <div class="span12">
        <div class="pull-left">
          <a href="../../" id="bannerLeft"><h1><img src="https://wcm.io/images/favicon-16@3x.png"/> wcm.io</h1></a>
          <p class="lead">Libraries and extensions for AEM applications</p>
        </div>
        <div class="pull-right">
        </div>
      </div>
    </div>
  </div>
    <div>
      <ul class="breadcrumb">
        <li><a href="../../" title="wcm.io">wcm.io</a></li>
        <li class="divider">/</li>
        <li><a href="../" title="Handler">Handler</a></li>
        <li class="divider">/</li>
        <li><a href="./" title="Media Handler">Media Handler</a></li>
        <li class="divider">/</li>
        <li>Media Handler System Configuration</li>
      </ul>
    </div>
  </header>

  <div class="main-body">
  <div class="row">
    <div class="span8">
      <div class="body-content">
<section> 
 <div class="page-header">
  <h2 id="Media_Handler_System_Configuration">Media Handler System Configuration</h2>
 </div> 
 <section> 
  <h3 id="Service_user_configuration_for_Asset_Rendition_Metadata">Service user configuration for Asset Rendition Metadata</h3> 
  <p>The DAM source implementation for Media Handler requires a background service that detects additional metadata for each rendition that is added, modified or removed for a DAM asset (to calculate their width and height and store them in the repository). Another service user mapping is required that allows the dynamic media support to read configured image profiles.</p> 
  <p>This service needs a principal-based service user mapping with an entry like this:</p> 
  <div class="source"> 
   <pre><code>  org.apache.sling.serviceusermapping.impl.ServiceUserMapperImpl.amended-myapp-wcmio-handler-media-mtd
    user.mapping=["io.wcm.handler.media:dam-rendition-metadata\=[dam-writer-service]"]
</code></pre> 
  </div> 
  <p>The built-in principal <code>dam-writer-service</code> has read/write access to <code>/content/dam</code>.</p> 
  <p>This configuration is required <b>only on author instances</b>.</p> 
 </section> 
 <section> 
  <h3 id="Service_user_configuration_for_Dynamic_Media_support">Service user configuration for Dynamic Media support</h3> 
  <p>Another service user mapping is required that allows the dynamic media support to read configured image profiles.</p> 
  <p>This service needs a principal-based service user mapping with an entry like this:</p> 
  <div class="source"> 
   <pre><code>  org.apache.sling.serviceusermapping.impl.ServiceUserMapperImpl.amended-myapp-wcmio-handler-media-dm
    user.mapping=["io.wcm.handler.media:dynamic-media-support\=[configuration-reader-service]"]
</code></pre> 
  </div> 
  <p>The built-in principal <code>configuration-reader-service</code> has read access to <code>/conf</code>.</p> 
  <p>This configuration is required <b>for both author and publish instances</b>.</p> 
  <p>Further system configuration options for <a href="dynamic-media.html">Dynamic Media</a>.</p> 
 </section> 
 <section> 
  <h3 id="Previews_for_inline_images_in_Authoring">Previews for inline images in Authoring</h3> 
  <p>The “FileUpload” Granite UI component provides a preview of the selected image in the edit dialog. This does not work out of the box if an inline image was uploaded to the component's resource (instead of selecting a DAM asset). In this case the component has to provide a preview of the image via the <code>img</code> selected. The media handler provides a servlet for this, but it has to be configured for each resource type that requires it.</p> 
  <p>Example for the <a class="externalLink" href="https://wcm.io/wcm/core-components/">wcm.io WCM Core Components</a> Responsive Image component for the factory configuration <code>io.wcm.handler.media.impl.InlineImageAuthorPreviewServlet</code>:</p> 
  <div class="source"> 
   <pre><code>sling.servlet.resourceTypes=["wcm-io/wcm/core/components/wcmio/responsiveimage/v1/responsiveimage"]
</code></pre> 
  </div> 
  <p>This configuration is required <b>only on author instances</b>.</p> 
 </section> 
 <section> 
  <h3 id="Workflow_process_for_rendition_metadata">Workflow process for rendition metadata</h3> 
  <p>There is also a workflow process implementation named “wcm.io Media Handler: Rendition metadata” that can be applied to any existing asset to generate the metadata (width/height information) for all assets that were present in the system before the background service was deployed. Create a custom workflow, add a “Process Step” and assign this process with “Handler Advance” flag.</p> 
  <p>However, this workflow process should not be part of the main “DAM Update Asset” workflow, as this would trigger the metadata generation twice for new assets.</p> 
  <p>See this <a class="externalLink" href="https://wcm-io.atlassian.net/wiki/x/AQDrRw">How-to article</a> for details.</p> 
 </section> 
</section>
      </div>
    </div>
    <div class="span4">
      <div id="toc-sidebar">
        <div class="well">
          <ul class="nav nav-list">
            <li class="nav-header">Table of Contents</li>
    <li class="dropdown"><a href="#Media_Handler_System_Configuration" title="Media Handler System Configuration">Media Handler System Configuration <b class="caret"></b></a>
      <ul class="nav nav-list">
    <li><a href="#Service_user_configuration_for_Asset_Rendition_Metadata" title="Service user configuration for Asset Rendition Metadata">Service user configuration for Asset Rendition Metadata</a>
    <li><a href="#Service_user_configuration_for_Dynamic_Media_support" title="Service user configuration for Dynamic Media support">Service user configuration for Dynamic Media support</a>
    <li><a href="#Previews_for_inline_images_in_Authoring" title="Previews for inline images in Authoring">Previews for inline images in Authoring</a>
    <li><a href="#Workflow_process_for_rendition_metadata" title="Workflow process for rendition metadata">Workflow process for rendition metadata</a>
        <li class="divider"></li>
      </ul>
    </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  </div>

  </div>

  <!-- Footer
  ================================================== -->
  <footer class="well">
    <div class="container">
      <div class="row">
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Main</li>
            <li >
              <a href="../../" title="Home">Home</a>
            </li>
            <li >
              <a href="../../platforms.html" title="Platforms">Platforms</a>
            </li>
            <li >
              <a href="../../maven.html" title="Maven Repositories">Maven Repositories</a>
            </li>
            <li >
              <a href="https://github.com/wcm-io" title="GitHub project" class="externalLink">GitHub project</a>
            </li>
            <li >
              <a href="../../subprojects.html" title="Subprojects">Subprojects</a>
            </li>
            <li >
              <a href="http://www.apache.org/licenses/LICENSE-2.0.txt" title="License" class="externalLink">License</a>
            </li>
            <li >
              <a href="../../commercial-support.html" title="Commercial Support">Commercial Support</a>
            </li>
            <li >
              <a href="https://diva-e.com/en/imprint/" title="Imprint" class="externalLink">Imprint</a>
            </li>
            <li >
              <a href="../../privacy.html" title="Privacy Policy">Privacy Policy</a>
            </li>
          </ul>
        </div>
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Categories</li>
            <li >
              <a href="../../wcm/" title="WCM">WCM</a>
            </li>
            <li >
              <a href="../../caconfig/" title="Context-Aware Configuration">Context-Aware Configuration</a>
            </li>
            <li >
              <a href="../" title="Handler">Handler</a>
            </li>
            <li >
              <a href="../../sling/" title="Sling Extensions">Sling Extensions</a>
            </li>
            <li >
              <a href="../../testing/" title="Testing">Testing</a>
            </li>
            <li >
              <a href="../../samples/" title="Samples">Samples</a>
            </li>
            <li >
              <a href="../../tooling/" title="Tooling">Tooling</a>
            </li>
          </ul>
        </div>
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Contribute</li>
            <li >
              <a href="../../contribute.html" title="Contribute">Contribute</a>
            </li>
            <li >
              <a href="../../manifest.html" title="Manifest">Manifest</a>
            </li>
            <li >
              <a href="https://github.com/wcm-io" title="Issues" class="externalLink">Issues</a>
            </li>
            <li >
              <a href="https://wcm-io.atlassian.net/wiki/" title="Wiki" class="externalLink">Wiki</a>
            </li>
            <li >
              <a href="../../mailing-lists.html" title="Mailing Lists">Mailing Lists</a>
            </li>
            <li >
              <a href="https://github.com/wcm-io" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
            </li>
          </ul>
        </div>
        <div class="span3 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Maven documentation</li>
            <li >
              <a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
            </li>
            <li >
              <a href="project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
            </li>
          </ul>
        </div>
        <div class="span3 bottom-description">
          <blockquote>wcm.io is an Open Source project which provides libraries and extensions for AEM-based applications.</blockquote>
        </div>
      </div>
    </div>
  </footer>

  <div class="container subfooter">
    <div class="row">
      <div class="span12">
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p class="copyright">Copyright &copy;2014-2024 <a href="https://wcm.io">wcm.io</a>. All Rights Reserved.</p>
        <p class="version-date"><span class="projectVersion">Version: 2.1.1-SNAPSHOT. </span><span class="publishDate">Last Published: 2024-08-23. </span></p>
      </div>
    </div>
  </div>

  <!-- JavaScript
  ================================================== -->
  <script src="https://wcm.io/js/jquery.min.js"></script>
  <script src="https://wcm.io/js/bootstrap.min.js"></script>
  <script src="https://wcm.io/js/lightbox.min.js"></script>
  <script src="https://wcm.io/js/reflow-scroll.js"></script>
  <script src="https://wcm.io/js/json5.min.js"></script>
  <script src="https://wcm.io/js/reflow-json-jcr-convert.js"></script>
  <script src="https://wcm.io/js/highlight.min.js"></script>


  <script src="https://wcm.io/js/reflow-skin.js"></script>

  </body>
</html>