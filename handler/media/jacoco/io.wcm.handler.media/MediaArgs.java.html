<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MediaArgs.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Media Handler</a> &gt; <a href="index.source.html" class="el_package">io.wcm.handler.media</a> &gt; <span class="el_source">MediaArgs.java</span></div><h1>MediaArgs.java</h1><pre class="source lang-java linenums">/*
 * #%L
 * wcm.io
 * %%
 * Copyright (C) 2014 wcm.io
 * %%
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * #L%
 */
package io.wcm.handler.media;

import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;
import java.util.Set;
import java.util.Objects;

import org.apache.commons.lang3.ArrayUtils;
import org.apache.commons.lang3.StringUtils;
import org.apache.commons.lang3.builder.EqualsBuilder;
import org.apache.commons.lang3.builder.HashCodeBuilder;
import org.apache.commons.lang3.builder.ToStringBuilder;
import org.apache.commons.lang3.builder.ToStringStyle;
import org.apache.sling.api.resource.ValueMap;
import org.apache.sling.api.wrappers.ValueMapDecorator;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.annotations.Nullable;
import org.osgi.annotation.versioning.ProviderType;

import io.wcm.handler.media.format.MediaFormat;
import io.wcm.handler.media.markup.DragDropSupport;
import io.wcm.handler.media.markup.IPERatioCustomize;
import io.wcm.handler.mediasource.dam.AemRenditionType;
import io.wcm.handler.url.UrlMode;
import io.wcm.wcm.commons.contenttype.FileExtension;
import io.wcm.wcm.commons.util.AemObjectReflectionToStringBuilder;

/**
 * Holds parameters to influence the media resolving process.
 */
@ProviderType
public final class MediaArgs implements Cloneable {

  private MediaFormatOption[] mediaFormatOptions;
  private boolean autoCrop;
  private String[] fileExtensions;
  private String enforceOutputFileExtension;
  private UrlMode urlMode;
  private long fixedWidth;
  private long fixedHeight;
  private boolean download;
  private boolean contentDispositionAttachment;
  private String altText;
  private boolean forceAltValueFromAsset;
  private boolean decorative;
<span class="fc" id="L66">  private boolean dummyImage = true;</span>
  private String dummyImageUrl;
  private Set&lt;AemRenditionType&gt; includeAssetAemRenditions;
  private Boolean includeAssetThumbnails;
  private Boolean includeAssetWebRenditions;
  private ImageSizes imageSizes;
  private PictureSource[] pictureSourceSets;
  private Double imageQualityPercentage;
<span class="fc" id="L74">  private DragDropSupport dragDropSupport = DragDropSupport.AUTO;</span>
<span class="fc" id="L75">  private IPERatioCustomize ipeRatioCustomize = IPERatioCustomize.AUTO;</span>
  private boolean dynamicMediaDisabled;
  private boolean webOptimizedImageDeliveryDisabled;
  private String videoManifestFormat;
  private boolean hostedVideoPlayer;
  private ValueMap properties;

<span class="fc" id="L82">  private static final Set&lt;String&gt; ALLOWED_FORCED_FILE_EXTENSIONS = Set.of(</span>
      FileExtension.JPEG, FileExtension.PNG);

  /**
   * Default constructor
   */
<span class="fc" id="L88">  public MediaArgs() {</span>
    // default constructor
<span class="fc" id="L90">  }</span>

  /**
   * Create media arguments with media formats.
   * @param mediaFormats Media formats
   */
  @SuppressWarnings(&quot;null&quot;)
<span class="fc" id="L97">  public MediaArgs(@NotNull MediaFormat @NotNull... mediaFormats) {</span>
<span class="fc" id="L98">    mediaFormats(mediaFormats);</span>
<span class="fc" id="L99">  }</span>

  /**
   * Create media arguments with media format names.
   * @param mediaFormatNames Media format names
   */
<span class="fc" id="L105">  public MediaArgs(@NotNull String @NotNull... mediaFormatNames) {</span>
<span class="fc" id="L106">    mediaFormatNames(mediaFormatNames);</span>
<span class="fc" id="L107">  }</span>

  /**
   * Returns list of media formats to resolve to.
   * @return Media formats
   */
  public MediaFormat @Nullable [] getMediaFormats() {
<span class="fc bfc" id="L114" title="All 2 branches covered.">    if (this.mediaFormatOptions != null) {</span>
<span class="fc" id="L115">      MediaFormat[] result = Arrays.stream(this.mediaFormatOptions)</span>
<span class="pc bpc" id="L116" title="1 of 2 branches missed.">          .filter(option -&gt; option.getMediaFormatName() == null)</span>
<span class="fc" id="L117">          .map(MediaFormatOption::getMediaFormat)</span>
<span class="fc" id="L118">          .toArray(size -&gt; new MediaFormat[size]);</span>
<span class="pc bpc" id="L119" title="1 of 2 branches missed.">      if (result.length &gt; 0) {</span>
<span class="fc" id="L120">        return result;</span>
      }
    }
<span class="fc" id="L123">    return null;</span>
  }

  /**
   * Sets list of media formats to resolve to.
   * @param values Media formats
   * @return this
   */
  public @NotNull MediaArgs mediaFormats(@Nullable MediaFormat @Nullable... values) {
<span class="pc bpc" id="L132" title="2 of 4 branches missed.">    if (values == null || values.length == 0) {</span>
<span class="nc" id="L133">      this.mediaFormatOptions = null;</span>
    }
    else {
<span class="fc" id="L136">      this.mediaFormatOptions = Arrays.stream(values)</span>
<span class="fc" id="L137">          .map(mediaFormat -&gt; new MediaFormatOption(mediaFormat, false))</span>
<span class="fc" id="L138">          .toArray(size -&gt; new MediaFormatOption[size]);</span>
    }
<span class="fc" id="L140">    return this;</span>
  }

  /**
   * Sets list of media formats to resolve to.
   * @param values Media formats
   * @return this
   */
  public @NotNull MediaArgs mandatoryMediaFormats(@NotNull MediaFormat @Nullable... values) {
<span class="pc bpc" id="L149" title="2 of 4 branches missed.">    if (values == null || values.length == 0) {</span>
<span class="nc" id="L150">      this.mediaFormatOptions = null;</span>
    }
    else {
<span class="fc" id="L153">      this.mediaFormatOptions = Arrays.stream(values)</span>
<span class="fc" id="L154">          .map(mediaFormat -&gt; new MediaFormatOption(mediaFormat, true))</span>
<span class="fc" id="L155">          .toArray(size -&gt; new MediaFormatOption[size]);</span>
    }
<span class="fc" id="L157">    return this;</span>
  }

  /**
   * Sets a single media format to resolve to.
   * @param value Media format
   * @return this
   */
  public @NotNull MediaArgs mediaFormat(MediaFormat value) {
<span class="fc bfc" id="L166" title="All 2 branches covered.">    if (value == null) {</span>
<span class="fc" id="L167">      this.mediaFormatOptions = null;</span>
    }
    else {
<span class="fc" id="L170">      this.mediaFormatOptions = new MediaFormatOption[] {</span>
          new MediaFormatOption(value, false)
      };
    }
<span class="fc" id="L174">    return this;</span>
  }

  /**
   * The &quot;mandatory&quot; flag of all media format options is set to to the given value.
   * @param value Resolving of all media formats is mandatory.
   * @return this
   */
  public @NotNull MediaArgs mediaFormatsMandatory(boolean value) {
<span class="nc bnc" id="L183" title="All 2 branches missed.">    if (this.mediaFormatOptions != null) {</span>
<span class="nc" id="L184">      this.mediaFormatOptions = Arrays.stream(this.mediaFormatOptions)</span>
<span class="nc" id="L185">          .map(option -&gt; option.withMandatory(value))</span>
<span class="nc" id="L186">          .toArray(size -&gt; new MediaFormatOption[size]);</span>
    }
<span class="nc" id="L188">    return this;</span>
  }

  /**
   * Returns list of media formats to resolve to. See {@link #getMediaFormatNames()} for details.
   * @return Media format names
   */
  public String @Nullable [] getMediaFormatNames() {
<span class="fc bfc" id="L196" title="All 2 branches covered.">    if (this.mediaFormatOptions != null) {</span>
<span class="fc" id="L197">      String[] result = Arrays.stream(this.mediaFormatOptions)</span>
<span class="fc bfc" id="L198" title="All 2 branches covered.">          .filter(option -&gt; option.getMediaFormatName() != null)</span>
<span class="fc" id="L199">          .map(MediaFormatOption::getMediaFormatName)</span>
<span class="fc" id="L200">          .toArray(size -&gt; new String[size]);</span>
<span class="fc bfc" id="L201" title="All 2 branches covered.">      if (result.length &gt; 0) {</span>
<span class="fc" id="L202">        return result;</span>
      }
    }
<span class="fc" id="L205">    return null;</span>
  }

  /**
   * Sets list of media formats to resolve to.
   * @param names Media format names.
   * @return this
   */
  public @NotNull MediaArgs mediaFormatNames(@NotNull String @Nullable... names) {
<span class="pc bpc" id="L214" title="2 of 4 branches missed.">    if (names == null || names.length == 0) {</span>
<span class="nc" id="L215">      this.mediaFormatOptions = null;</span>
    }
    else {
<span class="fc" id="L218">      this.mediaFormatOptions = Arrays.stream(names)</span>
<span class="fc" id="L219">          .map(name -&gt; new MediaFormatOption(name, false))</span>
<span class="fc" id="L220">          .toArray(size -&gt; new MediaFormatOption[size]);</span>
    }
<span class="fc" id="L222">    return this;</span>
  }

  /**
   * Sets list of media formats to resolve to.
   * @param names Media format names.
   * @return this
   */
  public @NotNull MediaArgs mandatoryMediaFormatNames(@NotNull String @Nullable... names) {
<span class="pc bpc" id="L231" title="2 of 4 branches missed.">    if (names == null || names.length == 0) {</span>
<span class="nc" id="L232">      this.mediaFormatOptions = null;</span>
    }
    else {
<span class="fc" id="L235">      this.mediaFormatOptions = Arrays.stream(names)</span>
<span class="fc" id="L236">          .map(name -&gt; new MediaFormatOption(name, true))</span>
<span class="fc" id="L237">          .toArray(size -&gt; new MediaFormatOption[size]);</span>
    }
<span class="fc" id="L239">    return this;</span>
  }

  /**
   * Sets a single media format to resolve to.
   * @param name Media format name
   * @return this
   */
  public @NotNull MediaArgs mediaFormatName(String name) {
<span class="fc bfc" id="L248" title="All 2 branches covered.">    if (name == null) {</span>
<span class="fc" id="L249">      this.mediaFormatOptions = null;</span>
    }
    else {
<span class="fc" id="L252">      this.mediaFormatOptions = new MediaFormatOption[] {</span>
          new MediaFormatOption(name, false)
      };
    }
<span class="fc" id="L256">    return this;</span>
  }

  /**
   * Gets list of media formats to resolve to.
   * @return Media formats with mandatory flag
   */
  public MediaFormatOption @Nullable [] getMediaFormatOptions() {
<span class="fc" id="L264">    return this.mediaFormatOptions;</span>
  }

  /**
   * Sets list of media formats to resolve to.
   * @param values Media formats with mandatory flag
   * @return this
   */
  public @NotNull MediaArgs mediaFormatOptions(@NotNull MediaFormatOption @Nullable... values) {
<span class="pc bpc" id="L273" title="1 of 4 branches missed.">    if (values == null || values.length == 0) {</span>
<span class="fc" id="L274">      this.mediaFormatOptions = null;</span>
    }
    else {
<span class="fc" id="L277">      this.mediaFormatOptions = values;</span>
    }
<span class="fc" id="L279">    return this;</span>
  }

  /**
   * Check if auto-cropping mode is enabled.
   * @return Enables &quot;auto-cropping&quot; mode. If no matching rendition is found
   *         it is tried to generate one by automatically cropping another one.
   */
  public boolean isAutoCrop() {
<span class="fc" id="L288">    return this.autoCrop;</span>
  }

  /**
   * Enable or disable auto-cropping mode.
   * @param value Enables &quot;auto-cropping&quot; mode. If no matching rendition is found
   *          it is tried to generate one by automatically cropping another one.
   * @return this
   */
  public @NotNull MediaArgs autoCrop(boolean value) {
<span class="fc" id="L298">    this.autoCrop = value;</span>
<span class="fc" id="L299">    return this;</span>
  }

  /**
   * Get accepted file extensions.
   * @return Accepted file extensions
   */
  public String @Nullable [] getFileExtensions() {
<span class="fc" id="L307">    return this.fileExtensions;</span>
  }

  /**
   * Set accepted file extensions.
   * @param values Accepted file extensions
   * @return this
   */
  public @NotNull MediaArgs fileExtensions(@NotNull String @Nullable... values) {
<span class="pc bpc" id="L316" title="2 of 4 branches missed.">    if (values == null || values.length == 0) {</span>
<span class="nc" id="L317">      this.fileExtensions = null;</span>
    }
    else {
<span class="fc" id="L320">      this.fileExtensions = values;</span>
    }
<span class="fc" id="L322">    return this;</span>
  }

  /**
   * Set accepted file extension.
   * @param value Accepted file extension
   * @return this
   */
  public @NotNull MediaArgs fileExtension(@Nullable String value) {
<span class="fc bfc" id="L331" title="All 2 branches covered.">    if (value == null) {</span>
<span class="fc" id="L332">      this.fileExtensions = null;</span>
    }
    else {
<span class="fc" id="L335">      this.fileExtensions = new String[] {</span>
          value
      };
    }
<span class="fc" id="L339">    return this;</span>
  }

  /**
   * Enforces image file type for renditions.
   *
   * &lt;p&gt;
   * By default, renditions are rendered with the same file type as the original rendition (except if the
   * original renditions uses a file type not directly supported in browser, e.g. a TIFF image).
   * With this parameter, it is possible to enforce generating renditions with this file type.
   * &lt;/p&gt;
   *
   * &lt;p&gt;
   * Supported file types: JPEG, PNG
   * &lt;/p&gt;
   * @return File extension to be used for returned renditions
   */
  public @Nullable String getEnforceOutputFileExtension() {
<span class="fc" id="L357">    return this.enforceOutputFileExtension;</span>
  }

  /**
   * Enforces image file type for renditions.
   *
   * &lt;p&gt;
   * By default, renditions are rendered with the same file type as the original rendition (except if the
   * original renditions uses a file type not directly supported in browser, e.g. a TIFF image).
   * With this parameter, it is possible to enforce generating renditions with this file type.
   * &lt;/p&gt;
   *
   * &lt;p&gt;
   * Supported file types: JPEG, PNG
   * &lt;/p&gt;
   * @param value File extension to be used for returned renditions
   * @return this
   */
  public @NotNull MediaArgs enforceOutputFileExtension(@Nullable String value) {
<span class="fc bfc" id="L376" title="All 2 branches covered.">    if (!ALLOWED_FORCED_FILE_EXTENSIONS.contains(value)) {</span>
<span class="fc" id="L377">      throw new IllegalArgumentException(&quot;Allowed enforced output file extensions: &quot;</span>
<span class="fc" id="L378">          + StringUtils.join(ALLOWED_FORCED_FILE_EXTENSIONS, &quot;,&quot;));</span>
    }
<span class="fc" id="L380">    this.enforceOutputFileExtension = value;</span>
<span class="fc" id="L381">    return this;</span>
  }

  /**
   * Get URL mode.
   * @return URL mode
   */
  public @Nullable UrlMode getUrlMode() {
<span class="fc" id="L389">    return this.urlMode;</span>
  }

  /**
   * Set URL mode.
   * @param value URS mode
   * @return this
   */
  public @NotNull MediaArgs urlMode(@Nullable UrlMode value) {
<span class="fc" id="L398">    this.urlMode = value;</span>
<span class="fc" id="L399">    return this;</span>
  }

  /**
   * Use fixed width instead of width from media format or original image
   * @return Fixed width
   */
  public long getFixedWidth() {
<span class="fc" id="L407">    return this.fixedWidth;</span>
  }

  /**
   * Use fixed width instead of width from media format or original image
   * @param value Fixed width
   * @return this
   */
  public @NotNull MediaArgs fixedWidth(long value) {
<span class="fc" id="L416">    this.fixedWidth = value;</span>
<span class="fc" id="L417">    return this;</span>
  }

  /**
   * Use fixed height instead of width from media format or original image
   * @return Fixed height
   */
  public long getFixedHeight() {
<span class="fc" id="L425">    return this.fixedHeight;</span>
  }

  /**
   * Use fixed height instead of width from media format or original image
   * @param value Fixed height
   * @return this
   */
  public @NotNull MediaArgs fixedHeight(long value) {
<span class="fc" id="L434">    this.fixedHeight = value;</span>
<span class="fc" id="L435">    return this;</span>
  }

  /**
   * Use fixed dimensions instead of width from media format or original image
   * @param widthValue Fixed width
   * @param heightValue Fixed height
   * @return this
   */
  public @NotNull MediaArgs fixedDimension(long widthValue, long heightValue) {
<span class="fc" id="L445">    this.fixedWidth = widthValue;</span>
<span class="fc" id="L446">    this.fixedHeight = heightValue;</span>
<span class="fc" id="L447">    return this;</span>
  }

  /**
   * Check if only download media formats are accepted.
   * @return Accept only media formats that have the download flag set.
   */
  public boolean isDownload() {
<span class="fc" id="L455">    return this.download;</span>
  }

  /**
   * Set whether to accept only download media formats.
   * @param value Accept only media formats that have the download flag set.
   * @return this
   */
  public @NotNull MediaArgs download(boolean value) {
<span class="fc" id="L464">    this.download = value;</span>
<span class="fc" id="L465">    return this;</span>
  }

  /**
   * Check if Content-Disposition header should be set to attachment.
   * @return Whether to set a &quot;Content-Disposition&quot; header to &quot;attachment&quot; for forcing a &quot;Save as&quot; dialog on the client
   */
  public boolean isContentDispositionAttachment() {
<span class="fc" id="L473">    return this.contentDispositionAttachment;</span>
  }

  /**
   * Set whether Content-Disposition header should be set to attachment.
   * @param value Whether to set a &quot;Content-Disposition&quot; header to &quot;attachment&quot; for forcing a &quot;Save as&quot; dialog on the
   *          client
   * @return this
   */
  public @NotNull MediaArgs contentDispositionAttachment(boolean value) {
<span class="fc" id="L483">    this.contentDispositionAttachment = value;</span>
<span class="fc" id="L484">    return this;</span>
  }

  /**
   * Get custom alternative text.
   * @return The custom alternative text that is to be used instead of the one defined in the the asset metadata.
   */
  public @Nullable String getAltText() {
<span class="fc" id="L492">    return this.altText;</span>
  }

  /**
   * Allows to specify a custom alternative text that is to be used instead of the one defined in the the asset
   * metadata.
   * @param value Custom alternative text. If null or empty, the default alt text from media library is used.
   * @return this
   */
  public @NotNull MediaArgs altText(@Nullable String value) {
<span class="fc" id="L502">    this.altText = value;</span>
<span class="fc" id="L503">    return this;</span>
  }

  /**
   * Check if alt text should be forced from DAM asset description.
   * @return Whether to force to read alt. text from DAM asset description.
   */
  public boolean isForceAltValueFromAsset() {
<span class="fc" id="L511">    return this.forceAltValueFromAsset;</span>
  }

  /**
   * Set whether to force alt text from DAM asset description.
   * @param value Whether to force to read alt. text from DAM asset description.
   *          If not set, the asset description is used as fallback value of no custom alt. text is defined.
   * @return this
   */
  public @NotNull MediaArgs forceAltValueFromAsset(boolean value) {
<span class="fc" id="L521">    this.forceAltValueFromAsset = value;</span>
<span class="fc" id="L522">    return this;</span>
  }

  /**
   * Check if image is marked as decorative.
   * @return Marks this image as &quot;decorative&quot;. Alt. text is then explicitly set to an empty string.
   */
  public boolean isDecorative() {
<span class="fc" id="L530">    return this.decorative;</span>
  }

  /**
   * Set whether image is decorative.
   * @param value Marks this image as &quot;decorative&quot;. Alt. text is then explicitly set to an empty string.
   * @return this
   */
  public @NotNull MediaArgs decorative(boolean value) {
<span class="fc" id="L539">    this.decorative = value;</span>
<span class="fc" id="L540">    return this;</span>
  }

  /**
   * Check if dummy image is enabled.
   * @return If set to true, media handler never returns a dummy image. Otherwise this can happen in edit mode.
   */
  public boolean isDummyImage() {
<span class="fc" id="L548">    return this.dummyImage;</span>
  }

  /**
   * Set whether dummy image is enabled.
   * @param value If set to false, media handler never returns a dummy image. Otherwise this can happen in edit mode.
   * @return this
   */
  public @NotNull MediaArgs dummyImage(boolean value) {
<span class="fc" id="L557">    this.dummyImage = value;</span>
<span class="fc" id="L558">    return this;</span>
  }

  /**
   * Get URL of custom dummy image.
   * @return Url of custom dummy image. If null default dummy image is used.
   */
  public @Nullable String getDummyImageUrl() {
<span class="fc" id="L566">    return this.dummyImageUrl;</span>
  }

  /**
   * Set URL of custom dummy image.
   * @param value Url of custom dummy image. If null default dummy image is used.
   * @return this
   */
  public @NotNull MediaArgs dummyImageUrl(@Nullable String value) {
<span class="fc" id="L575">    this.dummyImageUrl = value;</span>
<span class="fc" id="L576">    return this;</span>
  }

  /**
   * Get which types of AEM-generated renditions are included.
   * @return Defines which types of AEM-generated renditions (with &lt;code&gt;cq5dam.&lt;/code&gt; prefix) are taken into
   *         account when trying to resolve the media request.
   */
  public @Nullable Set&lt;AemRenditionType&gt; getIncludeAssetAemRenditions() {
<span class="fc" id="L585">    return this.includeAssetAemRenditions;</span>
  }

  /**
   * Set which types of AEM-generated renditions are included.
   * @param value Defines which types of AEM-generated renditions (with &lt;code&gt;cq5dam.&lt;/code&gt; prefix) are taken into
   *          account when trying to resolve the media request.
   * @return this
   */
  public @NotNull MediaArgs includeAssetAemRenditions(@Nullable Set&lt;AemRenditionType&gt; value) {
<span class="fc" id="L595">    this.includeAssetAemRenditions = value;</span>
<span class="fc" id="L596">    return this;</span>
  }

  /**
   * @return If set to true, thumbnail generated by AEM (with &lt;code&gt;cq5dam.thumbnail.&lt;/code&gt; prefix) are taken
   *         into account as well when trying to resolve the media request. Defaults to false.
   * @deprecated Use {@link #includeAssetAemRenditions(Set)} instead.
   */
  @Deprecated(since = &quot;2.0.0&quot;)
  public @Nullable Boolean isIncludeAssetThumbnails() {
<span class="fc" id="L606">    return this.includeAssetThumbnails;</span>
  }

  /**
   * @param value If set to true, thumbnail generated by AEM (with &lt;code&gt;cq5dam.thumbnail.&lt;/code&gt; prefix) are
   *          taken into account as well when trying to resolve the media request.
   * @return this
   * @deprecated Use {@link #includeAssetAemRenditions(Set)} instead.
   */
  @Deprecated(since = &quot;2.0.0&quot;)
  public @NotNull MediaArgs includeAssetThumbnails(boolean value) {
<span class="fc" id="L617">    this.includeAssetThumbnails = value;</span>
<span class="fc" id="L618">    return this;</span>
  }

  /**
   * @return If set to true, web renditions generated by AEM (with &lt;code&gt;cq5dam.web.&lt;/code&gt; prefix) are taken
   *         into account as well when trying to resolve the media request.
   *         If null, the default setting applies from the media handler configuration.
   * @deprecated Use {@link #includeAssetAemRenditions(Set)} instead.
   */
  @Deprecated(since = &quot;2.0.0&quot;)
  public @Nullable Boolean isIncludeAssetWebRenditions() {
<span class="fc" id="L629">    return this.includeAssetWebRenditions;</span>
  }

  /**
   * @param value If set to true, web renditions generated by AEM (with &lt;code&gt;cq5dam.web.&lt;/code&gt; prefix) are
   *          taken into account as well when trying to resolve the media request.
   * @return this
   * @deprecated Use {@link #includeAssetAemRenditions(Set)} instead.
   */
  @Deprecated(since = &quot;2.0.0&quot;)
  public @NotNull MediaArgs includeAssetWebRenditions(boolean value) {
<span class="fc" id="L640">    this.includeAssetWebRenditions = value;</span>
<span class="fc" id="L641">    return this;</span>
  }

  /**
   * Get image sizes for responsive image handling.
   * @return Image sizes for responsive image handling
   */
  public @Nullable ImageSizes getImageSizes() {
<span class="fc" id="L649">    return this.imageSizes;</span>
  }

  /**
   * Set image sizes for responsive image handling.
   * @param value Image sizes for responsive image handling
   * @return this
   */
  public @NotNull MediaArgs imageSizes(@Nullable ImageSizes value) {
<span class="fc" id="L658">    this.imageSizes = value;</span>
<span class="fc" id="L659">    return this;</span>
  }

  /**
   * Get picture sources for responsive image handling.
   * @return Picture sources for responsive image handling
   */
  public PictureSource @Nullable [] getPictureSources() {
<span class="fc" id="L667">    return this.pictureSourceSets;</span>
  }

  /**
   * Set picture sources for responsive image handling.
   * @param value Picture sources for responsive image handling
   * @return this
   */
  public @NotNull MediaArgs pictureSources(@NotNull PictureSource @Nullable... value) {
<span class="fc" id="L676">    this.pictureSourceSets = value;</span>
<span class="fc" id="L677">    return this;</span>
  }

  /**
   * Check if dynamic media support is disabled.
   * @return If set to true, dynamic media support is disabled even when enabled on the instance.
   */
  public boolean isDynamicMediaDisabled() {
<span class="fc" id="L685">    return this.dynamicMediaDisabled;</span>
  }

  /**
   * Set whether dynamic media support is disabled.
   * @param value If set to true, dynamic media support is disabled even when enabled on the instance.
   * @return this
   */
  public @NotNull MediaArgs dynamicMediaDisabled(boolean value) {
<span class="fc" id="L694">    this.dynamicMediaDisabled = value;</span>
<span class="fc" id="L695">    return this;</span>
  }

  /**
   * Check if web-optimized image delivery is disabled.
   * @return If set to true, web-optimized image delivery is disabled even when enabled on the instance.
   */
  public boolean isWebOptimizedImageDeliveryDisabled() {
<span class="fc" id="L703">    return this.webOptimizedImageDeliveryDisabled;</span>
  }

  /**
   * Set whether web-optimized image delivery is disabled.
   * @param value If set to true, web-optimized image delivery is disabled even when enabled on the instance.
   * @return this
   */
  public @NotNull MediaArgs webOptimizedImageDeliveryDisabled(boolean value) {
<span class="fc" id="L712">    this.webOptimizedImageDeliveryDisabled = value;</span>
<span class="fc" id="L713">    return this;</span>
  }

  /**
   * Get image quality percentage.
   * @return Image quality in percent (0..1) for images with lossy compression (e.g. JPEG).
   */
  public @Nullable Double getImageQualityPercentage() {
<span class="fc" id="L721">    return this.imageQualityPercentage;</span>
  }

  /**
   * Set image quality percentage.
   * @param value Image quality in percent (0..1) for images with lossy compression (e.g. JPEG).
   * @return this
   */
  public @NotNull MediaArgs imageQualityPercentage(@Nullable Double value) {
<span class="fc" id="L730">    this.imageQualityPercentage = value;</span>
<span class="fc" id="L731">    return this;</span>
  }

  /**
   * Drag&amp;amp;Drop support for media builder.
   * @return Drag&amp;amp;Drop support
   */
  public @NotNull DragDropSupport getDragDropSupport() {
<span class="fc" id="L739">    return this.dragDropSupport;</span>
  }

  /**
   * Drag&amp;amp;Drop support for media builder.
   * @param value Drag&amp;amp;Drop support
   * @return this
   */
  public @NotNull MediaArgs dragDropSupport(@NotNull DragDropSupport value) {
<span class="fc" id="L748">    this.dragDropSupport = value;</span>
<span class="fc" id="L749">    return this;</span>
  }

  /**
   * Get IPE ratio customization setting.
   * @return Whether to set customized list of IPE cropping ratios.
   */
  public IPERatioCustomize getIPERatioCustomize() {
<span class="fc" id="L757">    return this.ipeRatioCustomize;</span>
  }

  /**
   * Set IPE ratio customization setting.
   * @param value Whether to set customized list of IPE cropping ratios.
   * @return this
   */
  public @NotNull MediaArgs ipeRatioCustomize(@Nullable IPERatioCustomize value) {
<span class="fc" id="L766">    this.ipeRatioCustomize = value;</span>
<span class="fc" id="L767">    return this;</span>
  }

  /**
   * Get the preferred video manifest format.
   * @return Preferred video manifest format
   */
  public @Nullable String getVideoManifestFormat() {
<span class="fc" id="L775">    return this.videoManifestFormat;</span>
  }

  /**
   * Set the preferred video manifest format.
   * @param value Preferred video manifest format as file extension string
   *          (e.g. {@link MediaFileType#M3U8}{@code .getExtension()} for HLS,
   *          {@link MediaFileType#MPD}{@code .getExtension()} for DASH)
   * @return this
   */
  public @NotNull MediaArgs videoManifestFormat(@Nullable String value) {
<span class="fc" id="L786">    this.videoManifestFormat = value;</span>
<span class="fc" id="L787">    return this;</span>
  }

  /**
   * Check if hosted video player is enabled.
   * @return Whether to use Adobe's hosted video player instead of a streaming manifest,
   *         affecting both URL generation and markup (iframe vs. HTML5 video element).
   */
  public boolean isHostedVideoPlayer() {
<span class="fc" id="L796">    return this.hostedVideoPlayer;</span>
  }

  /**
   * Set whether to use hosted video player.
   * @param value Whether to use Adobe's hosted video player instead of a streaming manifest,
   *          affecting both URL generation and markup (iframe vs. HTML5 video element).
   * @return this
   */
  public @NotNull MediaArgs hostedVideoPlayer(boolean value) {
<span class="fc" id="L806">    this.hostedVideoPlayer = value;</span>
<span class="fc" id="L807">    return this;</span>
  }

  /**
   * Custom properties that my be used by application-specific markup builders or processors.
   * @param map Property map. Is merged with properties already set.
   * @return this
   */
  public @NotNull MediaArgs properties(@NotNull Map&lt;String, Object&gt; map) {
<span class="fc" id="L816">    getProperties().putAll(map);</span>
<span class="fc" id="L817">    return this;</span>
  }

  /**
   * Custom properties that my be used by application-specific markup builders or processors.
   * @param key Property key
   * @param value Property value
   * @return this
   */
  public @NotNull MediaArgs property(@NotNull String key, @Nullable Object value) {
<span class="fc" id="L827">    getProperties().put(key, value);</span>
<span class="fc" id="L828">    return this;</span>
  }

  /**
   * Custom properties that my be used by application-specific markup builders or processors.
   * @return Value map
   */
  @NotNull
  public ValueMap getProperties() {
<span class="fc bfc" id="L837" title="All 2 branches covered.">    if (this.properties == null) {</span>
<span class="fc" id="L838">      this.properties = new ValueMapDecorator(new HashMap&lt;&gt;());</span>
    }
<span class="fc" id="L840">    return this.properties;</span>
  }

  @Override
  public int hashCode() {
<span class="fc" id="L845">    return HashCodeBuilder.reflectionHashCode(this);</span>
  }

  @Override
  public boolean equals(Object obj) {
<span class="fc" id="L850">    return EqualsBuilder.reflectionEquals(this, obj);</span>
  }

  @Override
  @SuppressWarnings(&quot;java:S3776&quot;) // ignore complexity
  public String toString() {
<span class="fc" id="L856">    ToStringBuilder sb = new ToStringBuilder(this, ToStringStyle.NO_CLASS_NAME_STYLE);</span>
<span class="pc bpc" id="L857" title="3 of 4 branches missed.">    if (mediaFormatOptions != null &amp;&amp; mediaFormatOptions.length &gt; 0) {</span>
<span class="nc" id="L858">      sb.append(&quot;mediaFormats&quot;, &quot;[&quot; + StringUtils.join(mediaFormatOptions, &quot;, &quot;) + &quot;]&quot;);</span>
    }
<span class="pc bpc" id="L860" title="1 of 2 branches missed.">    if (autoCrop) {</span>
<span class="nc" id="L861">      sb.append(&quot;autoCrop&quot;, autoCrop);</span>
    }
<span class="pc bpc" id="L863" title="3 of 4 branches missed.">    if (fileExtensions != null &amp;&amp; fileExtensions.length &gt; 0) {</span>
<span class="nc" id="L864">      sb.append(&quot;fileExtensions&quot;, StringUtils.join(fileExtensions, &quot;,&quot;));</span>
    }
<span class="pc bpc" id="L866" title="1 of 2 branches missed.">    if (enforceOutputFileExtension != null) {</span>
<span class="nc" id="L867">      sb.append(&quot;enforceOutputFileExtension&quot;, enforceOutputFileExtension);</span>
    }
<span class="pc bpc" id="L869" title="1 of 2 branches missed.">    if (urlMode != null) {</span>
<span class="nc" id="L870">      sb.append(&quot;urlMode&quot;, urlMode);</span>
    }
<span class="pc bpc" id="L872" title="1 of 2 branches missed.">    if (fixedWidth &gt; 0) {</span>
<span class="nc" id="L873">      sb.append(&quot;fixedWidth&quot;, fixedWidth);</span>
    }
<span class="pc bpc" id="L875" title="1 of 2 branches missed.">    if (fixedHeight &gt; 0) {</span>
<span class="nc" id="L876">      sb.append(&quot;fixedHeight&quot;, fixedHeight);</span>
    }
<span class="pc bpc" id="L878" title="1 of 2 branches missed.">    if (download) {</span>
<span class="nc" id="L879">      sb.append(&quot;download&quot;, download);</span>
    }
<span class="pc bpc" id="L881" title="1 of 2 branches missed.">    if (contentDispositionAttachment) {</span>
<span class="nc" id="L882">      sb.append(&quot;contentDispositionAttachment&quot;, contentDispositionAttachment);</span>
    }
<span class="fc bfc" id="L884" title="All 2 branches covered.">    if (altText != null) {</span>
<span class="fc" id="L885">      sb.append(&quot;altText&quot;, altText);</span>
    }
<span class="pc bpc" id="L887" title="1 of 2 branches missed.">    if (forceAltValueFromAsset) {</span>
<span class="nc" id="L888">      sb.append(&quot;forceAltValueFromAsset&quot;, forceAltValueFromAsset);</span>
    }
<span class="pc bpc" id="L890" title="1 of 2 branches missed.">    if (decorative) {</span>
<span class="nc" id="L891">      sb.append(&quot;decorative&quot;, decorative);</span>
    }
<span class="pc bpc" id="L893" title="1 of 2 branches missed.">    if (!dummyImage) {</span>
<span class="nc" id="L894">      sb.append(&quot;dummyImage &quot;, dummyImage);</span>
    }
<span class="pc bpc" id="L896" title="1 of 2 branches missed.">    if (dummyImageUrl != null) {</span>
<span class="nc" id="L897">      sb.append(&quot;dummyImageUrl&quot;, dummyImageUrl);</span>
    }
<span class="pc bpc" id="L899" title="1 of 2 branches missed.">    if (includeAssetAemRenditions != null) {</span>
<span class="nc" id="L900">      sb.append(&quot;includeAssetAemRenditions&quot;, includeAssetAemRenditions);</span>
    }
<span class="pc bpc" id="L902" title="1 of 2 branches missed.">    if (includeAssetThumbnails != null) {</span>
<span class="nc" id="L903">      sb.append(&quot;includeAssetThumbnails&quot;, includeAssetThumbnails);</span>
    }
<span class="pc bpc" id="L905" title="1 of 2 branches missed.">    if (includeAssetWebRenditions != null) {</span>
<span class="nc" id="L906">      sb.append(&quot;includeAssetWebRenditions&quot;, includeAssetWebRenditions);</span>
    }
<span class="pc bpc" id="L908" title="1 of 2 branches missed.">    if (imageSizes != null) {</span>
<span class="nc" id="L909">      sb.append(&quot;imageSizes&quot;, imageSizes);</span>
    }
<span class="pc bpc" id="L911" title="3 of 4 branches missed.">    if (pictureSourceSets != null &amp;&amp; pictureSourceSets.length &gt; 0) {</span>
<span class="nc" id="L912">      sb.append(&quot;pictureSourceSets&quot;, &quot;[&quot; + StringUtils.join(pictureSourceSets, &quot;,&quot;) + &quot;]&quot;);</span>
    }
<span class="pc bpc" id="L914" title="1 of 2 branches missed.">    if (imageQualityPercentage != null) {</span>
<span class="nc" id="L915">      sb.append(&quot;imageQualityPercentage &quot;, imageQualityPercentage);</span>
    }
<span class="pc bpc" id="L917" title="1 of 2 branches missed.">    if (dragDropSupport != DragDropSupport.AUTO) {</span>
<span class="nc" id="L918">      sb.append(&quot;dragDropSupport &quot;, dragDropSupport);</span>
    }
<span class="pc bpc" id="L920" title="1 of 2 branches missed.">    if (ipeRatioCustomize != IPERatioCustomize.AUTO) {</span>
<span class="nc" id="L921">      sb.append(&quot;ipeRatioCustomize &quot;, ipeRatioCustomize);</span>
    }
<span class="pc bpc" id="L923" title="1 of 2 branches missed.">    if (dynamicMediaDisabled) {</span>
<span class="nc" id="L924">      sb.append(&quot;dynamicMediaDisabled&quot;, dynamicMediaDisabled);</span>
    }
<span class="pc bpc" id="L926" title="1 of 2 branches missed.">    if (webOptimizedImageDeliveryDisabled) {</span>
<span class="nc" id="L927">      sb.append(&quot;webOptimizedImageDeliveryDisabled&quot;, webOptimizedImageDeliveryDisabled);</span>
    }
<span class="pc bpc" id="L929" title="1 of 2 branches missed.">    if (videoManifestFormat != null) {</span>
<span class="nc" id="L930">      sb.append(&quot;videoManifestFormat&quot;, videoManifestFormat);</span>
    }
<span class="pc bpc" id="L932" title="1 of 2 branches missed.">    if (hostedVideoPlayer) {</span>
<span class="nc" id="L933">      sb.append(&quot;hostedVideoPlayer&quot;, hostedVideoPlayer);</span>
    }
<span class="pc bpc" id="L935" title="3 of 4 branches missed.">    if (properties != null &amp;&amp; !properties.isEmpty()) {</span>
<span class="nc" id="L936">      sb.append(&quot;properties&quot;, AemObjectReflectionToStringBuilder.filteredValueMap(properties));</span>
    }
<span class="fc" id="L938">    return sb.build();</span>
  }

  /**
   * Custom clone-method for {@link MediaArgs}
   * @return the cloned {@link MediaArgs}
   */
  @Override
  @SuppressWarnings({ &quot;java:S2975&quot;, &quot;java:S1182&quot;, &quot;checkstyle:SuperCloneCheck&quot; }) // ignore clone warnings
  public MediaArgs clone() { //NOPMD
<span class="fc" id="L948">    MediaArgs clone = new MediaArgs();</span>

<span class="fc" id="L950">    clone.mediaFormatOptions = ArrayUtils.clone(this.mediaFormatOptions);</span>
<span class="fc" id="L951">    clone.autoCrop = this.autoCrop;</span>
<span class="fc" id="L952">    clone.fileExtensions = ArrayUtils.clone(this.fileExtensions);</span>
<span class="fc" id="L953">    clone.enforceOutputFileExtension = this.enforceOutputFileExtension;</span>
<span class="fc" id="L954">    clone.urlMode = this.urlMode;</span>
<span class="fc" id="L955">    clone.fixedWidth = this.fixedWidth;</span>
<span class="fc" id="L956">    clone.fixedHeight = this.fixedHeight;</span>
<span class="fc" id="L957">    clone.download = this.download;</span>
<span class="fc" id="L958">    clone.contentDispositionAttachment = this.contentDispositionAttachment;</span>
<span class="fc" id="L959">    clone.altText = this.altText;</span>
<span class="fc" id="L960">    clone.forceAltValueFromAsset = this.forceAltValueFromAsset;</span>
<span class="fc" id="L961">    clone.decorative = this.decorative;</span>
<span class="fc" id="L962">    clone.dummyImage = this.dummyImage;</span>
<span class="fc" id="L963">    clone.dummyImageUrl = this.dummyImageUrl;</span>
<span class="fc" id="L964">    clone.includeAssetAemRenditions = this.includeAssetAemRenditions;</span>
<span class="fc" id="L965">    clone.includeAssetThumbnails = this.includeAssetThumbnails;</span>
<span class="fc" id="L966">    clone.includeAssetWebRenditions = this.includeAssetWebRenditions;</span>
<span class="fc" id="L967">    clone.imageSizes = this.imageSizes;</span>
<span class="fc" id="L968">    clone.pictureSourceSets = ArrayUtils.clone(this.pictureSourceSets);</span>
<span class="fc" id="L969">    clone.imageQualityPercentage = this.imageQualityPercentage;</span>
<span class="fc" id="L970">    clone.dragDropSupport = this.dragDropSupport;</span>
<span class="fc" id="L971">    clone.ipeRatioCustomize = this.ipeRatioCustomize;</span>
<span class="fc" id="L972">    clone.dynamicMediaDisabled = this.dynamicMediaDisabled;</span>
<span class="fc" id="L973">    clone.webOptimizedImageDeliveryDisabled = this.webOptimizedImageDeliveryDisabled;</span>
<span class="fc" id="L974">    clone.videoManifestFormat = this.videoManifestFormat;</span>
<span class="fc" id="L975">    clone.hostedVideoPlayer = this.hostedVideoPlayer;</span>
<span class="fc bfc" id="L976" title="All 2 branches covered.">    if (this.properties != null) {</span>
<span class="fc" id="L977">      clone.properties = new ValueMapDecorator(new HashMap&lt;&gt;(this.properties));</span>
    }

<span class="fc" id="L980">    return clone;</span>
  }

  /**
   * Media format to be applied on media processing.
   */
  @ProviderType
  public static final class MediaFormatOption {

    private final MediaFormat mediaFormat;
    private final String mediaFormatName;
    private final boolean mandatory;

    /**
     * Create media format option.
     * @param mediaFormat Media format
     * @param mandatory Resolution of this media format is mandatory
     */
<span class="fc" id="L998">    public MediaFormatOption(@Nullable MediaFormat mediaFormat, boolean mandatory) {</span>
<span class="fc" id="L999">      this.mediaFormat = mediaFormat;</span>
<span class="fc" id="L1000">      this.mediaFormatName = null;</span>
<span class="fc" id="L1001">      this.mandatory = mandatory;</span>
<span class="fc" id="L1002">    }</span>

    /**
     * Create media format option with format name.
     * @param mediaFormatName Media format name
     * @param mandatory Resolution of this media format is mandatory
     */
<span class="fc" id="L1009">    public MediaFormatOption(@NotNull String mediaFormatName, boolean mandatory) {</span>
<span class="fc" id="L1010">      this.mediaFormat = null;</span>
<span class="fc" id="L1011">      this.mediaFormatName = mediaFormatName;</span>
<span class="fc" id="L1012">      this.mandatory = mandatory;</span>
<span class="fc" id="L1013">    }</span>

    /**
     * Get media format.
     * @return Media format
     */
    public @Nullable MediaFormat getMediaFormat() {
<span class="fc" id="L1020">      return this.mediaFormat;</span>
    }

    /**
     * Get media format name.
     * @return Media format name
     */
    public @Nullable String getMediaFormatName() {
<span class="fc" id="L1028">      return this.mediaFormatName;</span>
    }

    /**
     * Check if resolution of this media format is mandatory.
     * @return Resolution of this media format is mandatory
     */
    public boolean isMandatory() {
<span class="fc" id="L1036">      return this.mandatory;</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L1041">      return HashCodeBuilder.reflectionHashCode(this);</span>
    }

    @Override
    public boolean equals(Object obj) {
<span class="fc" id="L1046">      return EqualsBuilder.reflectionEquals(this, obj);</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L1051">      return mediaFormatToString(mediaFormat, mediaFormatName, mandatory);</span>
    }

    @NotNull
    MediaFormatOption withMandatory(boolean newMandatory) {
<span class="nc bnc" id="L1056" title="All 2 branches missed.">      if (this.mediaFormat != null) {</span>
<span class="nc" id="L1057">        return new MediaFormatOption(this.mediaFormat, newMandatory);</span>
      }
      else {
<span class="nc" id="L1060">        return new MediaFormatOption(this.mediaFormatName, newMandatory);</span>
      }
    }

    static String mediaFormatToString(MediaFormat mediaFormat, String mediaFormatName, boolean mandatory) {
<span class="fc" id="L1065">      StringBuilder sb = new StringBuilder();</span>
<span class="pc bpc" id="L1066" title="1 of 2 branches missed.">      if (mediaFormat != null) {</span>
<span class="fc" id="L1067">        sb.append(mediaFormat.toString());</span>
      }
<span class="nc bnc" id="L1069" title="All 2 branches missed.">      else if (mediaFormatName != null) {</span>
<span class="nc" id="L1070">        sb.append(mediaFormatName);</span>
      }
<span class="pc bpc" id="L1072" title="1 of 2 branches missed.">      if (!mandatory) {</span>
<span class="nc" id="L1073">        sb.append(&quot;[?]&quot;);</span>
      }
<span class="fc" id="L1075">      return sb.toString();</span>
    }

  }

  /**
   * Image sizes for responsive image handling.
   */
  @ProviderType
  public static final class ImageSizes {

    private final @NotNull String sizes;
    private final @NotNull WidthOption @NotNull [] widthOptions;

    /**
     * Create image sizes with widths.
     * @param sizes A &lt;a href=&quot;http://w3c.github.io/html/semantics-embedded-content.html#valid-source-size-list&quot;&gt;valid
     *          source size list&lt;/a&gt;
     * @param widths Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute (all mandatory).
     */
<span class="fc" id="L1095">    public ImageSizes(@NotNull String sizes, long @NotNull... widths) {</span>
<span class="fc" id="L1096">      this.sizes = sizes;</span>
<span class="fc" id="L1097">      this.widthOptions = Arrays.stream(widths)</span>
<span class="fc" id="L1098">          .distinct()</span>
<span class="fc" id="L1099">          .mapToObj(width -&gt; new WidthOption(width, true))</span>
<span class="fc" id="L1100">          .toArray(WidthOption[]::new);</span>
<span class="fc" id="L1101">    }</span>

    /**
     * Create image sizes with width options.
     * @param sizes A &lt;a href=&quot;http://w3c.github.io/html/semantics-embedded-content.html#valid-source-size-list&quot;&gt;valid
     *          source size list&lt;/a&gt;
     * @param widthOptions Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute.
     */
<span class="fc" id="L1109">    public ImageSizes(@NotNull String sizes, @NotNull WidthOption @NotNull... widthOptions) {</span>
<span class="fc" id="L1110">      this.sizes = sizes;</span>
<span class="fc" id="L1111">      this.widthOptions = widthOptions;</span>
<span class="fc" id="L1112">    }</span>

    /**
     * Get source size list.
     * @return A &lt;a href=&quot;http://w3c.github.io/html/semantics-embedded-content.html#valid-source-size-list&quot;&gt;valid
     *         source size list&lt;/a&gt;
     */
    public @NotNull String getSizes() {
<span class="fc" id="L1120">      return this.sizes;</span>
    }

    /**
     * Get width options for responsive image renditions.
     * @return Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute.
     */
    public @NotNull WidthOption @Nullable [] getWidthOptions() {
<span class="fc" id="L1128">      return this.widthOptions;</span>
    }

    /**
     * Check if density descriptors should be used.
     * @return whether density descriptors should be used instead of width descriptors.
     */
    public boolean hasDensityDescriptors() {
<span class="fc bfc" id="L1136" title="All 2 branches covered.">      return StringUtils.isEmpty(this.sizes) &amp;&amp;</span>
<span class="pc bpc" id="L1137" title="1 of 2 branches missed.">              Arrays.stream(this.widthOptions).map(WidthOption::getDensity).anyMatch(Objects::nonNull);</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L1142">      return HashCodeBuilder.reflectionHashCode(this);</span>
    }

    @Override
    public boolean equals(Object obj) {
<span class="fc" id="L1147">      return EqualsBuilder.reflectionEquals(this, obj);</span>
    }

    @Override
    @SuppressWarnings(&quot;null&quot;)
    public String toString() {
<span class="fc" id="L1153">      ToStringBuilder sb = new ToStringBuilder(this, ToStringStyle.NO_CLASS_NAME_STYLE);</span>
<span class="fc" id="L1154">      sb.append(&quot;sizes&quot;, sizes);</span>
<span class="pc bpc" id="L1155" title="2 of 4 branches missed.">      if (widthOptions != null &amp;&amp; widthOptions.length &gt; 0) {</span>
<span class="fc" id="L1156">        sb.append(&quot;widthOptions&quot;, StringUtils.join(widthOptions, &quot;,&quot;));</span>
      }
<span class="fc" id="L1158">      return sb.build();</span>
    }

  }

  /**
   * Picture source for responsive image handling.
   */
  @ProviderType
  public static final class PictureSource {

    private MediaFormat mediaFormat;
    private String mediaFormatName;
    private String media;
    private String sizes;
    private WidthOption[] widthOptions;

    /**
     * Create picture source with media format.
     * @param mediaFormat Media format
     */
<span class="fc" id="L1179">    public PictureSource(@NotNull MediaFormat mediaFormat) {</span>
<span class="fc" id="L1180">      this.mediaFormat = mediaFormat;</span>
<span class="fc" id="L1181">    }</span>

    /**
     * Create picture source with media format name.
     * @param mediaFormatName Media format name
     */
<span class="fc" id="L1187">    public PictureSource(@Nullable String mediaFormatName) {</span>
<span class="fc" id="L1188">      this.mediaFormatName = mediaFormatName;</span>
<span class="fc" id="L1189">    }</span>

    private static @NotNull WidthOption @NotNull [] toWidthOptions(long @NotNull... widths) {
<span class="fc" id="L1192">      return Arrays.stream(widths)</span>
<span class="fc" id="L1193">          .distinct()</span>
<span class="fc" id="L1194">          .mapToObj(width -&gt; new WidthOption(width, true))</span>
<span class="fc" id="L1195">          .toArray(WidthOption[]::new);</span>
    }

    /**
     * Get media format.
     * @return Media format
     */
    public @Nullable MediaFormat getMediaFormat() {
<span class="fc" id="L1203">      return this.mediaFormat;</span>
    }

    /**
     * Get media format name.
     * @return Media format
     */
    public @Nullable String getMediaFormatName() {
<span class="fc" id="L1211">      return this.mediaFormatName;</span>
    }

    /**
     * Set width options for renditions.
     * @param value Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute.
     * @return this
     */
    public PictureSource widthOptions(@NotNull WidthOption @NotNull... value) {
<span class="fc" id="L1220">      this.widthOptions = value;</span>
<span class="fc" id="L1221">      return this;</span>
    }

    /**
     * Get width options for renditions.
     * @return Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute.
     */
    public @NotNull WidthOption @Nullable [] getWidthOptions() {
<span class="fc" id="L1229">      return this.widthOptions;</span>
    }

    /**
     * Set widths for renditions.
     * @param value Widths for the renditions in the &lt;code&gt;srcset&lt;/code&gt; attribute.
     * @return this
     */
    public PictureSource widths(long @NotNull... value) {
<span class="fc" id="L1238">      this.widthOptions = toWidthOptions(value);</span>
<span class="fc" id="L1239">      return this;</span>
    }

    /**
     * Set source size list.
     * @param value A &lt;a href=&quot;http://w3c.github.io/html/semantics-embedded-content.html#valid-source-size-list&quot;&gt;valid
     *          source size list&lt;/a&gt;.
     * @return this
     */
    public PictureSource sizes(@Nullable String value) {
<span class="fc" id="L1249">      this.sizes = value;</span>
<span class="fc" id="L1250">      return this;</span>
    }

    /**
     * Get source size list.
     * @return A &lt;a href=&quot;http://w3c.github.io/html/semantics-embedded-content.html#valid-source-size-list&quot;&gt;valid source
     *         size list&lt;/a&gt;.
     */
    public @Nullable String getSizes() {
<span class="fc" id="L1259">      return this.sizes;</span>
    }

    /**
     * Set media query list.
     * @param value A &lt;a href=&quot;http://w3c.github.io/html/infrastructure.html#valid-media-query-list&quot;&gt;valid media query
     *          list&lt;/a&gt;.
     * @return this
     */
    public PictureSource media(@Nullable String value) {
<span class="fc" id="L1269">      this.media = value;</span>
<span class="fc" id="L1270">      return this;</span>
    }

    /**
     * Get media query list.
     * @return A &lt;a href=&quot;http://w3c.github.io/html/infrastructure.html#valid-media-query-list&quot;&gt;valid media query
     *         list&lt;/a&gt;.
     */
    public @Nullable String getMedia() {
<span class="fc" id="L1279">      return this.media;</span>
    }

    /**
     * Check if density descriptors should be used.
     * @return whether density descriptors should be used instead of width descriptors.
     */
    public boolean hasDensityDescriptors() {
<span class="fc bfc" id="L1287" title="All 2 branches covered.">      return StringUtils.isEmpty(this.sizes) &amp;&amp;</span>
<span class="fc bfc" id="L1288" title="All 2 branches covered.">          Arrays.stream(this.widthOptions).map(WidthOption::getDensity).anyMatch(Objects::nonNull);</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L1293">      return HashCodeBuilder.reflectionHashCode(this);</span>
    }

    @Override
    public boolean equals(Object obj) {
<span class="fc" id="L1298">      return EqualsBuilder.reflectionEquals(this, obj);</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L1303">      ToStringBuilder sb = new ToStringBuilder(this, ToStringStyle.NO_CLASS_NAME_STYLE);</span>
<span class="fc" id="L1304">      sb.append(&quot;mediaFormat&quot;, MediaFormatOption.mediaFormatToString(mediaFormat, mediaFormatName, true));</span>
<span class="pc bpc" id="L1305" title="1 of 2 branches missed.">      if (media != null) {</span>
<span class="nc" id="L1306">        sb.append(&quot;media&quot;, media);</span>
      }
<span class="pc bpc" id="L1308" title="1 of 2 branches missed.">      if (sizes != null) {</span>
<span class="nc" id="L1309">        sb.append(&quot;sizes&quot;, sizes);</span>
      }
<span class="pc bpc" id="L1311" title="2 of 4 branches missed.">      if (widthOptions != null &amp;&amp; widthOptions.length &gt; 0) {</span>
<span class="fc" id="L1312">        sb.append(&quot;widthOptions&quot;, StringUtils.join(widthOptions, &quot;,&quot;));</span>
      }
<span class="fc" id="L1314">      return sb.build();</span>
    }

  }

  /**
   * Width value with mandatory flag.
   */
  @ProviderType
  public static final class WidthOption {

    private final long width;
    private final boolean mandatory;
    private final String density;

    /**
     * Create width option with mandatory width.
     * @param width mandatory width value
     */
    public WidthOption(long width) {
<span class="fc" id="L1334">      this(width, null, true);</span>
<span class="fc" id="L1335">    }</span>

    /**
     * Create width option with mandatory width and density.
     * @param width mandatory width value
     * @param density pixel density, or null for default density (1x)
     */
    public WidthOption(long width, @Nullable String density) {
<span class="fc" id="L1343">      this(width, density, true);</span>
<span class="fc" id="L1344">    }</span>

    /**
     * Create width option with optional mandatory flag.
     * @param width Width value
     * @param mandatory Is it mandatory to resolve a rendition with this width
     */
    public WidthOption(long width, boolean mandatory) {
<span class="fc" id="L1352">      this(width, null, mandatory);</span>
<span class="fc" id="L1353">    }</span>

    /**
     * Create width option with all parameters.
     * @param width Width value
     * @param density pixel density, or null for default density (1x)
     * @param mandatory Is it mandatory to resolve a rendition with this width
     */
<span class="fc" id="L1361">    public WidthOption(long width, @Nullable String density, boolean mandatory) {</span>
<span class="fc" id="L1362">      this.width = width;</span>
<span class="fc" id="L1363">      this.mandatory = mandatory;</span>
<span class="fc" id="L1364">      this.density = density;</span>
<span class="fc" id="L1365">    }</span>

    /**
     * Get width value.
     * @return Width value
     */
    public long getWidth() {
<span class="fc" id="L1372">      return this.width;</span>
    }

    /**
     * Check if width is mandatory.
     * @return Is it mandatory to resolve a rendition with this width
     */
    public boolean isMandatory() {
<span class="fc" id="L1380">      return this.mandatory;</span>
    }

    /**
     * Get density descriptor.
     * @return density descriptor or null
     */
    public @Nullable String getDensity() {
<span class="fc" id="L1388">      return density;</span>
    }

    /**
     * Get width descriptor for srcset attribute.
     * @return width descriptor for srcset, e.g. 200w
     */
    public @NotNull String getWidthDescriptor() {
<span class="fc" id="L1396">      return String.format(&quot;%dw&quot;, this.width);</span>
    }

    /**
     * Get density descriptor or empty string.
     * @return density descriptor if it is not null and is not &quot;1x&quot;, otherwise an empty string is returned
     */
    public @NotNull String getDensityDescriptor() {
<span class="fc bfc" id="L1404" title="All 4 branches covered.">      if (StringUtils.isEmpty(this.density) || StringUtils.equalsIgnoreCase(this.density, &quot;1x&quot;)) {</span>
<span class="fc" id="L1405">        return StringUtils.EMPTY;</span>
      }
<span class="fc" id="L1407">      return this.density;</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L1412">      return HashCodeBuilder.reflectionHashCode(this);</span>
    }

    @Override
    public boolean equals(Object obj) {
<span class="fc" id="L1417">      return EqualsBuilder.reflectionEquals(this, obj);</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L1422">      StringBuilder sb = new StringBuilder();</span>
<span class="fc" id="L1423">      sb.append(Long.toString(width));</span>
<span class="fc bfc" id="L1424" title="All 2 branches covered.">      if (density != null) {</span>
<span class="fc" id="L1425">        sb.append(&quot;:&quot;).append(density);</span>
      }
<span class="fc bfc" id="L1427" title="All 2 branches covered.">      if (!mandatory) {</span>
<span class="fc" id="L1428">        sb.append(&quot;?&quot;);</span>
      }
<span class="fc" id="L1430">      return sb.toString();</span>
    }

  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>