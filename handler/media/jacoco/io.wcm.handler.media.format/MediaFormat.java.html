<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MediaFormat.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Media Handler</a> &gt; <a href="index.source.html" class="el_package">io.wcm.handler.media.format</a> &gt; <span class="el_source">MediaFormat.java</span></div><h1>MediaFormat.java</h1><pre class="source lang-java linenums">/*
 * #%L
 * wcm.io
 * %%
 * Copyright (C) 2014 wcm.io
 * %%
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * #L%
 */
package io.wcm.handler.media.format;

import java.text.DecimalFormat;
import java.text.DecimalFormatSymbols;
import java.text.NumberFormat;
import java.util.ArrayList;
import java.util.List;
import java.util.Locale;

import org.apache.commons.lang3.StringUtils;
import org.apache.sling.api.resource.ValueMap;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.annotations.Nullable;
import org.osgi.annotation.versioning.ProviderType;

import com.fasterxml.jackson.annotation.JsonIgnore;
import com.fasterxml.jackson.annotation.JsonProperty;

import io.wcm.handler.media.Dimension;
import io.wcm.handler.media.MediaFileType;

/**
 * Media format.
 */
@ProviderType
public final class MediaFormat implements Comparable&lt;MediaFormat&gt; {

  private final String name;
  private final String label;
  private final String description;
  private final long width;
  private final long minWidth;
  private final long maxWidth;
  private final long height;
  private final long minHeight;
  private final long maxHeight;
  private final long minWidthHeight;
  private final double ratio;
  private final double ratioWidth;
  private final double ratioHeight;
  private final long fileSizeMax;
  private final String[] extensions;
  private final String renditionGroup;
  private final boolean download;
  private final boolean internal;
  private final int ranking;
  private final ValueMap properties;
  private String ratioDisplayString;
  private String combinedTitle;

  @SuppressWarnings({ &quot;java:S107&quot;, &quot;checkstyle:ParameterNumberCheck&quot; }) // ignore parameter count
  MediaFormat(String name, String label, String description,
      long width, long minWidth, long maxWidth, long height, long minHeight, long maxHeight, long minWidthHeight,
      double ratio, double ratioWidth, double ratioHeight, long fileSizeMax, String[] extensions,
<span class="fc" id="L74">      String renditionGroup, boolean download, boolean internal, int ranking, ValueMap properties) {</span>
<span class="fc" id="L75">    this.name = name;</span>
<span class="fc" id="L76">    this.label = label;</span>
<span class="fc" id="L77">    this.description = description;</span>
<span class="fc" id="L78">    this.width = width;</span>
<span class="fc" id="L79">    this.minWidth = minWidth;</span>
<span class="fc" id="L80">    this.maxWidth = maxWidth;</span>
<span class="fc" id="L81">    this.height = height;</span>
<span class="fc" id="L82">    this.minHeight = minHeight;</span>
<span class="fc" id="L83">    this.maxHeight = maxHeight;</span>
<span class="fc" id="L84">    this.minWidthHeight = minWidthHeight;</span>
<span class="fc" id="L85">    this.ratio = ratio;</span>
<span class="fc" id="L86">    this.ratioWidth = ratioWidth;</span>
<span class="fc" id="L87">    this.ratioHeight = ratioHeight;</span>
<span class="fc" id="L88">    this.fileSizeMax = fileSizeMax;</span>
<span class="fc" id="L89">    this.extensions = extensions;</span>
<span class="fc" id="L90">    this.renditionGroup = renditionGroup;</span>
<span class="fc" id="L91">    this.download = download;</span>
<span class="fc" id="L92">    this.internal = internal;</span>
<span class="fc" id="L93">    this.ranking = ranking;</span>
<span class="fc" id="L94">    this.properties = properties;</span>
<span class="fc" id="L95">  }</span>

  /**
   * Get media format name.
   * @return Media format name
   */
  @JsonProperty(&quot;mediaFormat&quot;)
  public @NotNull String getName() {
<span class="fc" id="L103">    return this.name;</span>
  }

  /**
   * Get media format label for display.
   * @return Media format label
   */
  @JsonIgnore
  public @NotNull String getLabel() {
<span class="fc" id="L112">    return StringUtils.defaultString(this.label, this.name);</span>
  }

  /**
   * Get media format description.
   * @return Media format description
   */
  @JsonIgnore
  public @Nullable String getDescription() {
<span class="fc" id="L121">    return this.description;</span>
  }

  /**
   * Get image width.
   * @return Image width (px)
   */
  @JsonIgnore
  public long getWidth() {
<span class="fc" id="L130">    return this.width;</span>
  }

  /**
   * Get minimum image width.
   * @return Min. image width (px)
   */
  @JsonIgnore
  public long getMinWidth() {
<span class="fc" id="L139">    return this.minWidth;</span>
  }

  /**
   * Get maximum image width.
   * @return Max. image width (px)
   */
  @JsonIgnore
  public long getMaxWidth() {
<span class="fc" id="L148">    return this.maxWidth;</span>
  }

  /**
   * Get image height.
   * @return Image height (px)
   */
  @JsonIgnore
  public long getHeight() {
<span class="fc" id="L157">    return this.height;</span>
  }

  /**
   * Get minimum image height.
   * @return Min. image height (px)
   */
  @JsonIgnore
  public long getMinHeight() {
<span class="fc" id="L166">    return this.minHeight;</span>
  }

  /**
   * Get maximum image height.
   * @return Max. image height (px)
   */
  @JsonIgnore
  public long getMaxHeight() {
<span class="fc" id="L175">    return this.maxHeight;</span>
  }

  /**
   * Get minimum width/height constraint.
   * @return Min. width/height (px) - the longest edge is checked.
   *         Cannot be combined with other width/height restrictions.
   */
  public long getMinWidthHeight() {
<span class="fc" id="L184">    return this.minWidthHeight;</span>
  }

  /**
   * Get ratio width value.
   * @return Ration width (px)
   */
  @JsonIgnore
  public double getRatioWidthAsDouble() {
<span class="fc" id="L193">    return this.ratioWidth;</span>
  }

  /**
   * Get ratio height value.
   * @return Ration height (px)
   */
  @JsonIgnore
  public double getRatioHeightAsDouble() {
<span class="fc" id="L202">    return this.ratioHeight;</span>
  }

  /**
   * Returns the ratio defined in the media format definition.
   * If no ratio is defined an the media format has a fixed width/height it is calculated automatically.
   * Otherwise 0 is returned.
   * @return Ratio
   */
  @JsonIgnore
  public double getRatio() {

    // get ratio from media format definition
<span class="fc bfc" id="L215" title="All 2 branches covered.">    if (this.ratio &gt; 0) {</span>
<span class="fc" id="L216">      return this.ratio;</span>
    }

    // get ratio from media format definition calculated from ratio sample/display values
<span class="pc bpc" id="L220" title="1 of 4 branches missed.">    if (this.ratioWidth &gt; 0 &amp;&amp; this.ratioHeight &gt; 0) {</span>
<span class="fc" id="L221">      return Ratio.get(this.ratioWidth, this.ratioHeight);</span>
    }

    // otherwise calculate ratio
<span class="pc bpc" id="L225" title="2 of 6 branches missed.">    if (isFixedDimension() &amp;&amp; this.width &gt; 0 &amp;&amp; this.height &gt; 0) {</span>
<span class="fc" id="L226">      return Ratio.get(this.width, this.height);</span>
    }

<span class="fc" id="L229">    return 0d;</span>
  }

  /**
   * Return display string for defined ratio.
   * @return Display string or null if media format has no ratio.
   */
  @JsonIgnore
  public String getRatioDisplayString() {
<span class="fc bfc" id="L238" title="All 2 branches covered.">    if (!hasRatio()) {</span>
<span class="fc" id="L239">      return null;</span>
    }

<span class="fc bfc" id="L242" title="All 2 branches covered.">    if (ratioDisplayString == null) {</span>
<span class="fc" id="L243">      ratioDisplayString = buildratioDisplayString(this);</span>
    }
<span class="fc" id="L245">    return ratioDisplayString;</span>
  }

  private static String buildratioDisplayString(MediaFormat mf) {
<span class="fc" id="L249">    String ratioDisplayString = null;</span>

<span class="fc" id="L251">    NumberFormat decimal1Format = new DecimalFormat(&quot;0.#&quot;, DecimalFormatSymbols.getInstance(Locale.US));</span>
<span class="pc bpc" id="L252" title="1 of 4 branches missed.">    if (mf.getRatioWidthAsDouble() &gt; 0 &amp;&amp; mf.getRatioHeightAsDouble() &gt; 0) {</span>
      // 1. check for explicit ratio numbers defined for the media format
<span class="fc" id="L254">      ratioDisplayString = decimal1Format.format(mf.getRatioWidthAsDouble())</span>
<span class="fc" id="L255">          + &quot;:&quot; + decimal1Format.format(mf.getRatioHeightAsDouble());</span>
    }
    else {
      // 2. try to guess a nice &quot;human-readable&quot; ratio string
<span class="fc" id="L259">      ratioDisplayString = guessHumanReadableRatioString(mf.getRatio(), decimal1Format);</span>
    }

<span class="fc bfc" id="L262" title="All 2 branches covered.">    if (ratioDisplayString == null) {</span>
<span class="pc bpc" id="L263" title="1 of 2 branches missed.">      if (mf.isFixedDimension()) {</span>
        // 3. use fixed dimension as ratio
<span class="fc" id="L265">        ratioDisplayString = decimal1Format.format(mf.getWidth())</span>
<span class="fc" id="L266">            + &quot;:&quot; + decimal1Format.format(mf.getHeight());</span>
      }
      else {
        // 4. last resort: disable decimal ratio value
<span class="nc" id="L270">        NumberFormat decimal3Format = new DecimalFormat(&quot;0.###&quot;, DecimalFormatSymbols.getInstance(Locale.US));</span>
<span class="nc" id="L271">        ratioDisplayString = &quot;R&quot; + decimal3Format.format(mf.getRatio());</span>
      }
    }

<span class="fc" id="L275">    return ratioDisplayString;</span>
  }

  /**
   * Try to guess a nice human readable ratio string from the given decimal ratio
   * @param ratio Ratio
   * @param numberFormat Number format
   * @return Ratio display string or null if no nice string was found
   */
  private static String guessHumanReadableRatioString(double ratio, NumberFormat numberFormat) {
<span class="pc bpc" id="L285" title="1 of 2 branches missed.">    if (ratio &gt; 0) {</span>
<span class="fc bfc" id="L286" title="All 2 branches covered.">      for (long width = 1; width &lt;= 50; width++) {</span>
<span class="fc" id="L287">        double height = width / ratio;</span>
<span class="fc bfc" id="L288" title="All 2 branches covered.">        if (isLong(height)) {</span>
<span class="fc" id="L289">          return numberFormat.format(width) + &quot;:&quot; + numberFormat.format(height);</span>
        }
      }
<span class="fc bfc" id="L292" title="All 2 branches covered.">      for (long width = 1; width &lt;= 200; width++) {</span>
<span class="fc" id="L293">        double height = width / 2d / ratio;</span>
<span class="fc bfc" id="L294" title="All 2 branches covered.">        if (isHalfLong(height)) {</span>
<span class="fc" id="L295">          return numberFormat.format(width / 2d) + &quot;:&quot; + numberFormat.format(height);</span>
        }
      }
    }
<span class="fc" id="L299">    return null;</span>
  }

  /**
   * @param value Value
   * @return true if the number ends with .0000 = is a nice integer
   */
  private static boolean isLong(double value) {
<span class="fc bfc" id="L307" title="All 2 branches covered.">    return Math.round(value * 10000d) == Math.round(value) * 10000L;</span>
  }

  /**
   * @param value Value
   * @return true if the number ends with .0000 or .5000 = is a nice integer or a half
   */
  private static boolean isHalfLong(double value) {
<span class="fc bfc" id="L315" title="All 2 branches covered.">    return (Math.round(value * 2d * 10000d) == Math.round(value * 2d) * 10000L);</span>
  }

  /**
   * Check if media format has ratio.
   * @return true if the media format has ratio (calculated for fixed dimensions or defined in media format)
   */
  @JsonIgnore
  public boolean hasRatio() {
<span class="fc bfc" id="L324" title="All 2 branches covered.">    return getRatio() &gt; 0;</span>
  }

  /**
   * Get maximum file size.
   * @return Max. file size (bytes)
   */
  @JsonIgnore
  public long getFileSizeMax() {
<span class="fc" id="L333">    return this.fileSizeMax;</span>
  }

  /**
   * Get allowed file extensions.
   * @return Allowed file extensions
   */
  @JsonIgnore
  public String[] getExtensions() {
<span class="pc bpc" id="L342" title="1 of 2 branches missed.">    return this.extensions != null ? this.extensions.clone() : null;</span>
  }

  /**
   * Get rendition group ID.
   * @return Rendition group id
   */
  @JsonIgnore
  public String getRenditionGroup() {
<span class="fc" id="L351">    return this.renditionGroup;</span>
  }

  /**
   * Check if media should be downloaded.
   * @return Media assets with this format should be downloaded and not displayed directly
   */
  @JsonIgnore
  public boolean isDownload() {
<span class="fc" id="L360">    return this.download;</span>
  }

  /**
   * Check if format is for internal use only.
   * @return For internal use only (not displayed for user)
   */
  @JsonIgnore
  public boolean isInternal() {
<span class="fc" id="L369">    return this.internal;</span>
  }

  /**
   * Get ranking for auto-detection priority.
   * @return Ranking for auto-detection. Lowest value = highest priority.
   */
  @JsonIgnore
  public long getRanking() {
<span class="fc" id="L378">    return this.ranking;</span>
  }

  /**
   * Check if format allows image extensions.
   * @return Whether the format allows at least one image extension
   */
  @JsonIgnore
  public boolean isImage() {
<span class="fc bfc" id="L387" title="All 2 branches covered.">    for (String extension : getExtensions()) {</span>
<span class="fc bfc" id="L388" title="All 2 branches covered.">      if (MediaFileType.isImage(extension)) {</span>
<span class="fc" id="L389">        return true;</span>
      }
    }
<span class="fc" id="L392">    return false;</span>
  }

  /**
   * Checks if the media format has a fixed width defined, and no min/max constraints.
   * @return If the media format has a fixed dimension.
   */
  @JsonIgnore
  public boolean isFixedWidth() {
<span class="pc bpc" id="L401" title="2 of 6 branches missed.">    return getWidth() &gt; 0 &amp;&amp; getMinWidth() == 0 &amp;&amp; getMaxWidth() == 0;</span>
  }

  /**
   * Checks if the media format has a fixed height defined, and no min/max constraints.
   * @return If the media format has a fixed dimension.
   */
  @JsonIgnore
  public boolean isFixedHeight() {
<span class="pc bpc" id="L410" title="2 of 6 branches missed.">    return getHeight() &gt; 0 &amp;&amp; getMinHeight() == 0 &amp;&amp; getMaxHeight() == 0;</span>
  }

  /**
   * Checks if the media format has a fixed width and height defined, and no min/max constraints.
   * @return If the media format has a fixed dimension.
   */
  @JsonIgnore
  public boolean isFixedDimension() {
<span class="fc bfc" id="L419" title="All 4 branches covered.">    return isFixedWidth() &amp;&amp; isFixedHeight();</span>
  }

  /**
   * Get effective minimum image width.
   * @return Effective min. image width (px). Takes widthMin and width into account.
   */
  @JsonIgnore
  public long getEffectiveMinWidth() {
<span class="fc" id="L428">    long widthMin = getMinWidth();</span>
<span class="fc bfc" id="L429" title="All 2 branches covered.">    if (widthMin == 0) {</span>
<span class="fc" id="L430">      widthMin = getWidth();</span>
    }
<span class="fc" id="L432">    return widthMin;</span>
  }

  /**
   * Get effective maximum image width.
   * @return Effective max. image width (px). Takes widthMax and width into account.
   */
  @JsonIgnore
  public long getEffectiveMaxWidth() {
<span class="fc" id="L441">    long widthMax = getMaxWidth();</span>
<span class="fc bfc" id="L442" title="All 2 branches covered.">    if (widthMax == 0) {</span>
<span class="fc" id="L443">      widthMax = getWidth();</span>
    }
<span class="fc" id="L445">    return widthMax;</span>
  }

  /**
   * Get effective minimum image height.
   * @return Effective min. image height (px). Takes heightMin and height into account.
   */
  @JsonIgnore
  public long getEffectiveMinHeight() {
<span class="fc" id="L454">    long heightMin = getMinHeight();</span>
<span class="fc bfc" id="L455" title="All 2 branches covered.">    if (heightMin == 0) {</span>
<span class="fc" id="L456">      heightMin = getHeight();</span>
    }
<span class="fc" id="L458">    return heightMin;</span>
  }

  /**
   * Get effective maximum image height.
   * @return Effective max. image height (px). Takes heightMax and height into account.
   */
  @JsonIgnore
  public long getEffectiveMaxHeight() {
<span class="fc" id="L467">    long heightMax = getMaxHeight();</span>
<span class="fc bfc" id="L468" title="All 2 branches covered.">    if (heightMax == 0) {</span>
<span class="fc" id="L469">      heightMax = getHeight();</span>
    }
<span class="fc" id="L471">    return heightMax;</span>
  }

  /**
   * Get minimum dimensions for media format. If only width or height is defined the missing dimensions
   * is calculated from the ratio. If no ratio defined either only width or height dimension is returned.
   * If neither width or height are defined null is returned.
   * @return Min. dimensions or null
   */
  @JsonIgnore
  public Dimension getMinDimension() {
<span class="fc" id="L482">    long effWithMin = getEffectiveMinWidth();</span>
<span class="fc" id="L483">    long effHeightMin = getEffectiveMinHeight();</span>
<span class="fc" id="L484">    double effRatio = getRatio();</span>

<span class="fc bfc" id="L486" title="All 6 branches covered.">    if (effWithMin == 0 &amp;&amp; effHeightMin &gt; 0 &amp;&amp; effRatio &gt; 0) {</span>
<span class="fc" id="L487">      effWithMin = Math.round(effHeightMin * effRatio);</span>
    }
<span class="fc bfc" id="L489" title="All 6 branches covered.">    if (effWithMin &gt; 0 &amp;&amp; effHeightMin == 0 &amp;&amp; effRatio &gt; 0) {</span>
<span class="fc" id="L490">      effHeightMin = Math.round(effWithMin / effRatio);</span>
    }

<span class="fc bfc" id="L493" title="All 4 branches covered.">    if (effWithMin &gt; 0 || effHeightMin &gt; 0) {</span>
<span class="fc" id="L494">      return new Dimension(effWithMin, effHeightMin);</span>
    }
    else {
<span class="fc" id="L497">      return null;</span>
    }
  }

  /**
   * @return User-friendly combined title of current media format name and dimension.
   */
  @JsonIgnore
  @SuppressWarnings({ &quot;java:S3776&quot;, &quot;java:S6541&quot; }) // ignore complexity
  String getCombinedTitle() {
<span class="fc bfc" id="L507" title="All 2 branches covered.">    if (combinedTitle == null) {</span>
<span class="fc" id="L508">      StringBuilder sb = new StringBuilder();</span>

<span class="fc" id="L510">      sb.append(getLabel());</span>

<span class="fc" id="L512">      List&lt;String&gt; extParts = new ArrayList&lt;&gt;();</span>

      // width/height restrictions
<span class="fc bfc" id="L515" title="All 2 branches covered.">      if (minWidthHeight != 0) {</span>
<span class="fc" id="L516">        extParts.add(&quot;min. &quot; + minWidthHeight + &quot;px width/height&quot;);</span>
      }
      else {
<span class="fc" id="L519">        long widthMin = getEffectiveMinWidth();</span>
<span class="fc" id="L520">        long widthMax = getEffectiveMaxWidth();</span>
<span class="fc" id="L521">        long heightMin = getEffectiveMinHeight();</span>
<span class="fc" id="L522">        long heightMax = getEffectiveMaxHeight();</span>
<span class="fc bfc" id="L523" title="All 8 branches covered.">        if (widthMin &gt; 0 || widthMax &gt; 0 || heightMin &gt; 0 || heightMax &gt; 0) {</span>
<span class="fc" id="L524">          StringBuilder sbRestrictions = new StringBuilder();</span>
<span class="fc bfc" id="L525" title="All 2 branches covered.">          if (widthMin == widthMax) {</span>
<span class="fc bfc" id="L526" title="All 2 branches covered.">            if (widthMin == 0) {</span>
<span class="fc" id="L527">              sbRestrictions.append(&quot;?&quot;);</span>
            }
            else {
<span class="fc" id="L530">              sbRestrictions.append(widthMin);</span>
            }
          }
          else {
<span class="fc bfc" id="L534" title="All 2 branches covered.">            if (widthMin &gt; 0) {</span>
<span class="fc" id="L535">              sbRestrictions.append(widthMin);</span>
            }
<span class="fc" id="L537">            sbRestrictions.append(&quot;..&quot;);</span>
<span class="fc bfc" id="L538" title="All 2 branches covered.">            if (widthMax &gt; 0) {</span>
<span class="fc" id="L539">              sbRestrictions.append(widthMax);</span>
            }
          }
<span class="fc" id="L542">          sbRestrictions.append('x');</span>
<span class="fc bfc" id="L543" title="All 2 branches covered.">          if (heightMin == heightMax) {</span>
<span class="fc bfc" id="L544" title="All 2 branches covered.">            if (heightMin == 0) {</span>
<span class="fc" id="L545">              sbRestrictions.append(&quot;?&quot;);</span>
            }
            else {
<span class="fc" id="L548">              sbRestrictions.append(heightMin);</span>
            }
          }
          else {
<span class="fc bfc" id="L552" title="All 2 branches covered.">            if (heightMin &gt; 0) {</span>
<span class="fc" id="L553">              sbRestrictions.append(heightMin);</span>
            }
<span class="fc" id="L555">            sbRestrictions.append(&quot;..&quot;);</span>
<span class="fc bfc" id="L556" title="All 2 branches covered.">            if (heightMax &gt; 0) {</span>
<span class="fc" id="L557">              sbRestrictions.append(heightMax);</span>
            }
          }
<span class="fc" id="L560">          sbRestrictions.append(&quot;px&quot;);</span>
<span class="fc" id="L561">          extParts.add(sbRestrictions.toString());</span>
        }
      }

      // ratio (if label contains a &quot;:&quot; it is assumed a ratio is already contained in the label)
<span class="fc bfc" id="L566" title="All 4 branches covered.">      if (hasRatio() &amp;&amp; !StringUtils.contains(getLabel(), &quot;:&quot;)) {</span>
<span class="fc" id="L567">        String ratioString = getRatioDisplayString();</span>
<span class="pc bpc" id="L568" title="1 of 2 branches missed.">        if (StringUtils.isNotEmpty(ratioString)) {</span>
<span class="fc" id="L569">          extParts.add(ratioString);</span>
        }
      }

      // display max. 6 extensions in combined title
<span class="fc" id="L574">      final int MAX_EXTENSIONS = 6;</span>
<span class="fc" id="L575">      StringBuilder extensionsString = new StringBuilder();</span>
<span class="fc" id="L576">      String[] extensionList = getExtensions();</span>
<span class="pc bpc" id="L577" title="1 of 2 branches missed.">      if (extensionList != null) {</span>
<span class="fc bfc" id="L578" title="All 4 branches covered.">        for (int i = 0; i &lt; extensionList.length &amp;&amp; i &lt; MAX_EXTENSIONS; i++) {</span>
<span class="fc bfc" id="L579" title="All 2 branches covered.">          if (i &gt; 0) {</span>
<span class="fc" id="L580">            extensionsString.append(',');</span>
          }
<span class="fc" id="L582">          extensionsString.append(extensionList[i]);</span>
        }
<span class="fc bfc" id="L584" title="All 2 branches covered.">        if (extensionList.length &gt; MAX_EXTENSIONS) {</span>
<span class="fc" id="L585">          extensionsString.append(&quot;...&quot;);</span>
        }
<span class="fc bfc" id="L587" title="All 2 branches covered.">        if (extensionList.length &gt; 0) {</span>
<span class="fc" id="L588">          extParts.add(extensionsString.toString());</span>
        }
      }

      // add extended display parts
<span class="fc bfc" id="L593" title="All 2 branches covered.">      if (!extParts.isEmpty()) {</span>
<span class="fc" id="L594">        sb.append(&quot; (&quot;)</span>
<span class="fc" id="L595">            .append(StringUtils.join(extParts, &quot;; &quot;))</span>
<span class="fc" id="L596">            .append(')');</span>
      }

<span class="fc" id="L599">      combinedTitle = sb.toString();</span>
    }
<span class="fc" id="L601">    return combinedTitle;</span>
  }

  /**
   * Get custom properties.
   * @return Custom properties that my be used by application-specific markup builders or processors.
   */
  @JsonIgnore
  public ValueMap getProperties() {
<span class="fc" id="L610">    return this.properties;</span>
  }

  /**
   * @return User-friendly combined title of current media format name and dimension.
   */
  @Override
  public String toString() {
<span class="fc" id="L618">    return getCombinedTitle();</span>
  }

  @Override
  public boolean equals(Object pObj) {
<span class="pc bpc" id="L623" title="1 of 2 branches missed.">    if (pObj instanceof MediaFormat) {</span>
<span class="fc" id="L624">      MediaFormat other = (MediaFormat)pObj;</span>
<span class="fc" id="L625">      return name.equals(other.name);</span>
    }
    else {
<span class="nc" id="L628">      return false;</span>
    }
  }

  @Override
  public int hashCode() {
<span class="fc" id="L634">    return name.hashCode();</span>
  }

  @Override
  public int compareTo(MediaFormat o) {
<span class="fc" id="L639">    return this.name.compareTo(o.name);</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>