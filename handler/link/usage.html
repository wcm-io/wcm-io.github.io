
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2024-12-09
 Rendered using Reflow Maven Skin 1.2.0 (https://github.com/wcm-io/wcm-io-tooling/tree/develop/maven/skins/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

  <head>
    <meta charset="UTF-8" />
    <title>Link Handler Usage | wcm.io</title>

    <link rel="shortcut icon" href="https://wcm.io/images/favicon.ico">
    <link rel="apple-touch-icon" href="https://wcm.io/images/favicon-152.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="wcm.io - Libraries and extensions for AEM applications" />
    <meta http-equiv="content-language" content="en" />

    <link href="https://wcm.io/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://wcm.io/css/docs.css" rel="stylesheet" />
    <link href="https://wcm.io/css/reflow-skin.css" rel="stylesheet" />
    <link href="https://wcm.io/css/highlightjs-style-github.min.css" rel="stylesheet" />

    <link href="https://wcm.io/css/lightbox.css" rel="stylesheet" />

    <link href="https://wcm.io/css/site.css" rel="stylesheet" />
    <link href="https://wcm.io/css/print.css" rel="stylesheet" media="print" />


  </head>

  <body class="page-usage project-io.wcm.handler.link" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../..">wcm.io</a>
          <div class="nav-collapse collapse" id="top-nav-collapse">
            <ul class="nav pull-right">
              <li ><a href="https://github.com/wcm-io" title="GitHub project" class="externalLink">GitHub project</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Categories <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li ><a href="../../wcm/" title="WCM">WCM</a></li>
                  <li ><a href="../../caconfig/" title="Context-Aware Configuration">Context-Aware Configuration</a></li>
                  <li ><a href="../" title="Handler">Handler</a></li>
                  <li ><a href="../../sling/" title="Sling Extensions">Sling Extensions</a></li>
                  <li ><a href="../../testing/" title="Testing">Testing</a></li>
                  <li ><a href="../../samples/" title="Samples">Samples</a></li>
                  <li ><a href="../../tooling/" title="Tooling">Tooling</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contribute <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li ><a href="../../contribute.html" title="Contribute">Contribute</a></li>
                  <li ><a href="../../manifest.html" title="Manifest">Manifest</a></li>
                  <li ><a href="https://github.com/wcm-io" title="Issues" class="externalLink">Issues</a></li>
                  <li ><a href="https://wcm-io.atlassian.net/wiki/" title="Wiki" class="externalLink">Wiki</a></li>
                  <li ><a href="../../mailing-lists.html" title="Mailing Lists">Mailing Lists</a></li>
                  <li ><a href="https://github.com/wcm-io" title="Fork on GitHub" class="externalLink">Fork on GitHub</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

  <div class="container">

  <!-- Masthead
  ================================================== -->

  <header>
  <div class="jumbotron subhead">
    <div class="row" id="banner">
      <div class="span12">
        <div class="pull-left">
          <a href="../../" id="bannerLeft"><h1><img src="https://wcm.io/images/favicon-16@3x.png"/> wcm.io</h1></a>
          <p class="lead">Libraries and extensions for AEM applications</p>
        </div>
        <div class="pull-right">
        </div>
      </div>
    </div>
  </div>
    <div>
      <ul class="breadcrumb">
        <li><a href="../../" title="wcm.io">wcm.io</a></li>
        <li class="divider">/</li>
        <li><a href="../" title="Handler">Handler</a></li>
        <li class="divider">/</li>
        <li><a href="./" title="Link Handler">Link Handler</a></li>
        <li class="divider">/</li>
        <li>Link Handler Usage</li>
      </ul>
    </div>
  </header>

  <div class="main-body">
  <div class="row">
    <div class="span8">
      <div class="body-content">
<section> 
 <div class="page-header">
  <h2 id="Link_Handler_Usage">Link Handler Usage</h2>
 </div> 
 <section> 
  <h3 id="Building_links">Building links</h3> 
  <p>The <a href="apidocs/io/wcm/handler/link/LinkHandler.html">Link Handler</a> is a Sling Model and can be adapted either from a request or a resource. It automatically reads the context-specific configuration for the Site URLs of the <a href="../url/">URL Handler</a> based on the resource path of the current request or the path of the resource adapted from.</p> 
  <p>Example:</p> 
  <div class="source"> 
   <pre><code class="language-java">LinkHandler linkHandler = request.adaptTo(LinkHandler.class);

// build link stored in current resource
Link link = linkHandler.get(resource).build();

// build link targeting the given content page with a different selector and extension
Link link = linkHandler.get(contentPage).selector("sel1").extension("pdf").build();

// check if link is valid and get markup
if (link.isValid()) {
  String markup = link.getMarkup();
  // ...
}
</code></pre> 
  </div> 
  <p>Alternatively you can inject the <code>LinkHandler</code> into your Sling Model using the <code>@Self</code> annotation if the model itself adapts from request or resource.</p> 
  <p>The link handler uses a “builder pattern” so you can flexibly combine the different link generation options. See <a href="apidocs/io/wcm/handler/link/LinkBuilder.html">LinkBuilder</a> for all options.</p> 
 </section> 
 <section> 
  <h3 id="Link_properties_in_resource">Link properties in resource</h3> 
  <p>When storing a link in a resource multiple properties are used to describe the link. The properties depend on the link type implementations, these are the most important properties supported by the built-in link types:</p> 
  <ul> 
   <li><code>linkType</code>: Type of links as chosen by the editor (e.g. internal, external or media)</li> 
   <li><code>linkContentRef</code>: Path of internal content page to link to</li> 
   <li><code>linkMediaRef</code>: Path of media asset (e.g. DAM asset) to link to</li> 
   <li><code>linkExternalRef</code>: External URL to link to</li> 
   <li><code>linkWindowTarget</code>: Target for window to open link in (e.g. “_blank”)</li> 
   <li><code>linkFragment</code>: Fragment part to add to link URL</li> 
   <li><code>linkQueryParam</code>: Query parameters to add to link URL</li> 
  </ul> 
  <p>Further properties are defined in <a href="apidocs/io/wcm/handler/link/LinkNameConstants.html">LinkNameConstants</a>. It is recommended to define an edit dialog that shows only the properties supported for the selected link type after choosing one.</p> 
  <p>If using the <a href="graniteui-components.html">Link Reference Container Granite UI component</a> to show link related properties in the edit dialog be aware that some of the properties defined in the <code>LinkNameConstants</code> do not have a representation by default. Eg: it is required to add <code>linkFragment</code> and <code>linkQueryParam</code> separately in order to add fragment and query string support to the link generation.</p> 
 </section> 
 <section> 
  <h3 id="Using_links_in_HTL.2FSightly_template">Using links in HTL/Sightly template</h3> 
  <p>To resolve a link inside a HTL template you can use a generic Sling Model for calling the handler: <a href="apidocs/io/wcm/handler/link/ui/ResourceLink.html">ResourceLink</a></p> 
  <p>HTL template example:</p> 
  <div class="source"> 
   <pre><code class="language-html">&lt;sly data-sly-use.link="io.wcm.handler.link.ui.ResourceLink"/&gt;
&lt;a data-sly-attribute="${link.attributes}" data-sly-test="${link.valid}"&gt;
  ${properties.linkTitle}
&lt;/a&gt;
&lt;div class="cq-placeholder" data-emptytext="${component.title}" data-sly-test="${!link.valid}"&gt;&lt;/div&gt;
</code></pre> 
  </div> 
  <p>In this case the anchor defined in the sightly template is used, but all attributes of the <code>a</code> element are overwritten with those returned by the link handler. This is primary the href attribute, but may contain further for defining the link target or custom metadata for user tracking.</p> 
 </section> 
 <section> 
  <h3 id="Configuring_and_tailoring_the_link_resolving_process">Configuring and tailoring the link resolving process</h3> 
  <p>Optionally you can provide an OSGi service to specify in more detail the link resolving needs of your application. For this you have to extend the <a href="apidocs/io/wcm/handler/link/spi/LinkHandlerConfig.html">LinkHandlerConfig</a> class. Via <a href="../../sling/commons/context-aware-services.html">Context-Aware Services</a> you can make sure the SPI customization affects only resources (content pages, DAM assets) that are relevant for your application. Thus it is possible to provide different customizations for different applications running in the same AEM instance.</p> 
  <p>With this you can:</p> 
  <ul> 
   <li>Define which link types are supported by your application or include your own ones</li> 
   <li>Define which markup builders are supported by your application or include your own ones</li> 
   <li>Define custom pre- and postprocessors that are called before and after the link resolving takes place</li> 
   <li>Implement a method which decides whether a content page is allowed to link to or not</li> 
   <li>Implement a method which decides whether a content page is a redirect page or not</li> 
  </ul> 
  <p>Example:</p> 
  <div class="source"> 
   <pre><code class="language-java">@Component(service = LinkHandlerConfig.class, property = {
    ContextAwareService.PROPERTY_CONTEXT_PATH_PATTERN + "=^/content/(dam/)?myapp(/.*)?$"
})
public class LinkHandlerConfigImpl extends LinkHandlerConfig {

  private static final List&lt;Class&lt;? extends LinkType&gt;&gt; LINK_TYPES =
      ImmutableList.&lt;Class&lt;? extends LinkType&gt;&gt;of(
          InternalLinkType.class,
          InternalCrossScopeLinkType.class,
          ExternalLinkType.class,
          MediaLinkType.class
      );

  @Override
  public List&lt;Class&lt;? extends LinkType&gt;&gt; getLinkTypes() {
    return LINK_TYPES;
  }

  @Override
  public boolean isRedirect(Page page) {
    String template = page.getProperties().get(NameConstants.PN_TEMPLATE, String.class);
    return StringUtils.equals(template, "/apps/sample/templates/redirect");
  }

}
</code></pre> 
  </div> 
  <p>Schematic flow of link handling process:</p> 
  <ol style="list-style-type: decimal"> 
   <li>Start link handler processing</li> 
   <li>Detect link type, store result in link request</li> 
   <li>Apply preprocessors on link request</li> 
   <li>Resolve link using link type, store result in link request</li> 
   <li>Generate markup using markup builder, store result in link request</li> 
   <li>Apply postprocessors on link request</li> 
  </ol> 
 </section> 
 <section> 
  <h3 id="Migrate_components_to_Link_Handler">Migrate components to Link Handler</h3> 
  <p>If you migrate existing components that did not use the wcm.io Link Handler before, it's likely you used only one single property which contained all types of links - internal, external, DAM asset. This storage as one single property is not compatible with the Link Handler, which uses at least two property (link type and link reference), and the second property depends on the link type.</p> 
  <p>But you can configure a special “fallback mode” on the component resource by setting a property - example:</p> 
  <div class="source"> 
   <pre><code class="language-javascript">{
  "wcmio:linkTargetUrlFallbackProperty": "linkUrl"
}
</code></pre> 
  </div> 
  <p>When this property is set, the component is also able to read link target information from the property “linkUrl” and tries to auto-detect it's type. When the component is edited using the Link Handler link dialog tab, it's read from this property as well. Once the dialog is saved the property is cleared and the new property names as used by the Link Handler are used.</p> 
 </section> 
</section>
      </div>
    </div>
    <div class="span4">
      <div id="toc-sidebar">
        <div class="well">
          <ul class="nav nav-list">
            <li class="nav-header">Table of Contents</li>
    <li class="dropdown"><a href="#Link_Handler_Usage" title="Link Handler Usage">Link Handler Usage <b class="caret"></b></a>
      <ul class="nav nav-list">
    <li><a href="#Building_links" title="Building links">Building links</a>
    <li><a href="#Link_properties_in_resource" title="Link properties in resource">Link properties in resource</a>
    <li><a href="#Using_links_in_HTL.2FSightly_template" title="Using links in HTL/Sightly template">Using links in HTL/Sightly template</a>
    <li><a href="#Configuring_and_tailoring_the_link_resolving_process" title="Configuring and tailoring the link resolving process">Configuring and tailoring the link resolving process</a>
    <li><a href="#Migrate_components_to_Link_Handler" title="Migrate components to Link Handler">Migrate components to Link Handler</a>
        <li class="divider"></li>
      </ul>
    </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  </div>

  </div>

  <!-- Footer
  ================================================== -->
  <footer class="well">
    <div class="container">
      <div class="row">
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Main</li>
            <li >
              <a href="../../" title="Home">Home</a>
            </li>
            <li >
              <a href="../../platforms.html" title="Platforms">Platforms</a>
            </li>
            <li >
              <a href="../../maven.html" title="Maven Repositories">Maven Repositories</a>
            </li>
            <li >
              <a href="https://github.com/wcm-io" title="GitHub project" class="externalLink">GitHub project</a>
            </li>
            <li >
              <a href="../../subprojects.html" title="Subprojects">Subprojects</a>
            </li>
            <li >
              <a href="http://www.apache.org/licenses/LICENSE-2.0.txt" title="License" class="externalLink">License</a>
            </li>
            <li >
              <a href="../../commercial-support.html" title="Commercial Support">Commercial Support</a>
            </li>
            <li >
              <a href="https://diva-e.com/en/imprint/" title="Imprint" class="externalLink">Imprint</a>
            </li>
            <li >
              <a href="../../privacy.html" title="Privacy Policy">Privacy Policy</a>
            </li>
          </ul>
        </div>
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Categories</li>
            <li >
              <a href="../../wcm/" title="WCM">WCM</a>
            </li>
            <li >
              <a href="../../caconfig/" title="Context-Aware Configuration">Context-Aware Configuration</a>
            </li>
            <li >
              <a href="../" title="Handler">Handler</a>
            </li>
            <li >
              <a href="../../sling/" title="Sling Extensions">Sling Extensions</a>
            </li>
            <li >
              <a href="../../testing/" title="Testing">Testing</a>
            </li>
            <li >
              <a href="../../samples/" title="Samples">Samples</a>
            </li>
            <li >
              <a href="../../tooling/" title="Tooling">Tooling</a>
            </li>
          </ul>
        </div>
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Contribute</li>
            <li >
              <a href="../../contribute.html" title="Contribute">Contribute</a>
            </li>
            <li >
              <a href="../../manifest.html" title="Manifest">Manifest</a>
            </li>
            <li >
              <a href="https://github.com/wcm-io" title="Issues" class="externalLink">Issues</a>
            </li>
            <li >
              <a href="https://wcm-io.atlassian.net/wiki/" title="Wiki" class="externalLink">Wiki</a>
            </li>
            <li >
              <a href="../../mailing-lists.html" title="Mailing Lists">Mailing Lists</a>
            </li>
            <li >
              <a href="https://github.com/wcm-io" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
            </li>
          </ul>
        </div>
        <div class="span3 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Maven documentation</li>
            <li >
              <a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
            </li>
            <li >
              <a href="project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
            </li>
          </ul>
        </div>
        <div class="span3 bottom-description">
          <blockquote>wcm.io is an Open Source project which provides libraries and extensions for AEM-based applications.</blockquote>
        </div>
      </div>
    </div>
  </footer>

  <div class="container subfooter">
    <div class="row">
      <div class="span12">
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p class="copyright">Copyright &copy;2014-2024 <a href="https://wcm.io">wcm.io</a>. All Rights Reserved.</p>
        <p class="version-date"><span class="projectVersion">Version: 2.2.3-SNAPSHOT. </span><span class="publishDate">Last Published: 2024-12-09. </span></p>
      </div>
    </div>
  </div>

  <!-- JavaScript
  ================================================== -->
  <script src="https://wcm.io/js/jquery.min.js"></script>
  <script src="https://wcm.io/js/bootstrap.min.js"></script>
  <script src="https://wcm.io/js/lightbox.min.js"></script>
  <script src="https://wcm.io/js/reflow-scroll.js"></script>
  <script src="https://wcm.io/js/json5.min.js"></script>
  <script src="https://wcm.io/js/reflow-json-jcr-convert.js"></script>
  <script src="https://wcm.io/js/highlight.min.js"></script>


  <script src="https://wcm.io/js/reflow-skin.js"></script>

  </body>
</html>