<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PackageManagerProperties.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">CRX Package Manager Helper</a> &gt; <a href="index.source.html" class="el_package">io.wcm.tooling.commons.packmgr</a> &gt; <span class="el_source">PackageManagerProperties.java</span></div><h1>PackageManagerProperties.java</h1><pre class="source lang-java linenums">/*
 * #%L
 * wcm.io
 * %%
 * Copyright (C) 2017 wcm.io
 * %%
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * #L%
 */
package io.wcm.tooling.commons.packmgr;

import java.util.Collections;
import java.util.List;
import java.util.Objects;
import java.util.regex.Pattern;
import java.util.stream.Collectors;

/**
 * Configuration properties for {@link PackageManagerHelper}.
 */
<span class="nc" id="L31">public final class PackageManagerProperties {</span>

  private String packageManagerUrl;
  private String userId;
  private String password;
  private String oauth2AccessToken;
  private String consoleUserId;
  private String consolePassword;
  private String consoleOauth2AccessToken;
<span class="nc" id="L40">  private int retryCount = 24;</span>
<span class="nc" id="L41">  private int retryDelaySec = 5;</span>
  private String bundleStatusUrl;
<span class="nc" id="L43">  private int bundleStatusWaitLimitSec = 360;</span>
<span class="nc" id="L44">  private List&lt;Pattern&gt; bundleStatusBlacklistBundleNames = Collections.emptyList();</span>
<span class="nc" id="L45">  private List&lt;Pattern&gt; bundleStatusWhitelistBundleNames = Collections.emptyList();</span>
  private String systemReadyUrl;
<span class="nc" id="L47">  private int systemReadyWaitLimitSec = 30;</span>
  private String packageManagerInstallStatusURL;
<span class="nc" id="L49">  private int packageManagerInstallStatusWaitLimitSec = 360;</span>
  private boolean relaxedSSLCheck;
<span class="nc" id="L51">  private int httpConnectTimeoutSec = 10;</span>
<span class="nc" id="L52">  private int httpSocketTimeoutSec = 60;</span>
  private List&lt;Proxy&gt; proxies;
<span class="nc" id="L54">  private String packageManagerOutputLogLevel = &quot;INFO&quot;;</span>

  /**
   * The URL of the HTTP service API of the CRX package manager.
   * See &lt;a href=
   * &quot;https://docs.adobe.com/content/docs/en/crx/2-3/how_to/package_manager.html#Managing%20Packages%20on%20the%20Command%20Line&quot;&gt;CRX
   * HTTP service Interface&lt;/a&gt; for details on this interface.
   * @return URL
   */
  public String getPackageManagerUrl() {
<span class="nc" id="L64">    return this.packageManagerUrl;</span>
  }

  /**
   * @param packageManagerUrl The URL of the HTTP service API of the CRX package manager.
   */
  public void setPackageManagerUrl(String packageManagerUrl) {
<span class="nc" id="L71">    this.packageManagerUrl = packageManagerUrl;</span>
<span class="nc" id="L72">  }</span>

  /**
   * The user name to authenticate as against the remote CRX system (package manager).
   * @return User ID
   */
  public String getUserId() {
<span class="nc" id="L79">    return this.userId;</span>
  }

  /**
   * @param userId The user name to authenticate as against the remote CRX system (package manager).
   */
  public void setUserId(String userId) {
<span class="nc" id="L86">    this.userId = userId;</span>
<span class="nc" id="L87">  }</span>

  /**
   * The password to authenticate against the remote CRX system (package manager).
   * @return Password
   */
  public String getPassword() {
<span class="nc" id="L94">    return this.password;</span>
  }

  /**
   * @param password The password to authenticate against the remote CRX system (package manager).
   */
  public void setPassword(String password) {
<span class="nc" id="L101">    this.password = password;</span>
<span class="nc" id="L102">  }</span>

  /**
   * OAuth 2 access token to authenticate against the remote CRX system (package manager).
   * If this is configured, username and password are ignored.
   * @return OAuth 2 access token.
   */
  public String getOAuth2AccessToken() {
<span class="nc" id="L110">    return this.oauth2AccessToken;</span>
  }

  /**
   * @param value OAuth 2 access token to authenticate against the remote CRX system (package manager).
   */
  public void setOAuth2AccessToken(String value) {
<span class="nc" id="L117">    this.oauth2AccessToken = value;</span>
<span class="nc" id="L118">  }</span>

  /**
   * The user name to authenticate as against the remote CRX system (Felix console).
   * Fallback to {@link #getUserId()} if not set.
   * @return User ID
   */
  public String getConsoleUserId() {
<span class="nc" id="L126">    return Objects.toString(this.consoleUserId, this.userId);</span>
  }

  /**
   * @param consoleUserId The user name to authenticate as against the remote CRX system (Felix console).
   */
  public void setConsoleUserId(String consoleUserId) {
<span class="nc" id="L133">    this.consoleUserId = consoleUserId;</span>
<span class="nc" id="L134">  }</span>

  /**
   * The password to authenticate against the remote CRX system (Felix console).
   * Fallback to {@link #getPassword()} if not set.
   * @return Password
   */
  public String getConsolePassword() {
<span class="nc" id="L142">    return Objects.toString(this.consolePassword, this.password);</span>
  }

  /**
   * @param consolePassword The password to authenticate against the remote CRX system (Felix console).
   */
  public void setConsolePassword(String consolePassword) {
<span class="nc" id="L149">    this.consolePassword = consolePassword;</span>
<span class="nc" id="L150">  }</span>

  /**
   * OAuth 2 access token to authenticate against the remote CRX system (Felix console).
   * If this is configured, username and password are ignored.
   * Fallback to {@link #getOAuth2AccessToken()} if not set.
   * @return OAuth 2 access token.
   */
  public String getConsoleOAuth2AccessToken() {
<span class="nc" id="L159">    return Objects.toString(this.consoleOauth2AccessToken, this.oauth2AccessToken);</span>
  }

  /**
   * @param value OAuth 2 access token to authenticate against the remote CRX system (Felix console).
   */
  public void setConsoleOAuth2AccessToken(String value) {
<span class="nc" id="L166">    this.consoleOauth2AccessToken = value;</span>
<span class="nc" id="L167">  }</span>

  /**
   * Number of times to retry upload and install via CRX HTTP interface if it fails.
   * @return Retry count
   */
  public int getRetryCount() {
<span class="nc" id="L174">    return this.retryCount;</span>
  }

  /**
   * @param retryCount Number of times to retry upload and install via CRX HTTP interface if it fails.
   */
  public void setRetryCount(int retryCount) {
<span class="nc" id="L181">    this.retryCount = retryCount;</span>
<span class="nc" id="L182">  }</span>

  /**
   * Number of seconds between retry attempts.
   * @return Retry delay
   */
  public int getRetryDelaySec() {
<span class="nc" id="L189">    return this.retryDelaySec;</span>
  }

  /**
   * @param retryDelaySec Number of seconds between retry attempts.
   */
  public void setRetryDelaySec(int retryDelaySec) {
<span class="nc" id="L196">    this.retryDelaySec = retryDelaySec;</span>
<span class="nc" id="L197">  }</span>

  /**
   * Bundle status JSON URL. If an URL is configured the activation status of all bundles in the system is checked
   * before it is tried to upload and install a new package and after each upload.
   * If not all bundles are activated the upload is delayed up to {link #getBundleStatusWaitLimitSec()} seconds, every 5
   * seconds the activation status is checked anew.
   * Expected is an URL like: http://localhost:4502/system/console/bundles/.json
   * @return URL
   */
  public String getBundleStatusUrl() {
<span class="nc" id="L208">    return this.bundleStatusUrl;</span>
  }

  /**
   * @param bundleStatusUrl Bundle status JSON URL
   */
  public void setBundleStatusUrl(String bundleStatusUrl) {
<span class="nc" id="L215">    this.bundleStatusUrl = bundleStatusUrl;</span>
<span class="nc" id="L216">  }</span>

  /**
   * Number of seconds to wait as maximum for a positive bundle status check.
   * If this limit is reached and the bundle status is still not positive the install of the package proceeds anyway.
   * @return Limit in seconds
   */
  public int getBundleStatusWaitLimitSec() {
<span class="nc" id="L224">    return this.bundleStatusWaitLimitSec;</span>
  }

  /**
   * @param bundleStatusWaitLimitSec Number of seconds to wait as maximum for a positive bundle status
   */
  public void setBundleStatusWaitLimitSec(int bundleStatusWaitLimitSec) {
<span class="nc" id="L231">    this.bundleStatusWaitLimitSec = bundleStatusWaitLimitSec;</span>
<span class="nc" id="L232">  }</span>

  /**
   * Patterns for symbolic names of bundles that are expected to be not present in bundle list.
   * If any of these bundles are found in the bundle list, this system is assumed as not ready for installing further
   * packages because a previous installation (e.g. of AEM service pack) is still in progress.
   * @return List of regular expressions for symbolic bundle names.
   */
  public List&lt;Pattern&gt; getBundleStatusBlacklistBundleNames() {
<span class="nc" id="L241">    return this.bundleStatusBlacklistBundleNames;</span>
  }

  /**
   * @param bundleStatusBlacklistBundleNames Patterns for symbolic names of bundles that are expected to be not present
   *          in bundle list
   */
  public void setBundleStatusBlacklistBundleNames(List&lt;String&gt; bundleStatusBlacklistBundleNames) {
<span class="nc" id="L249">    this.bundleStatusBlacklistBundleNames = bundleStatusBlacklistBundleNames.stream()</span>
<span class="nc" id="L250">        .map(Pattern::compile)</span>
<span class="nc" id="L251">        .collect(Collectors.toList());</span>
<span class="nc" id="L252">  }</span>

  /**
   * Patterns for symbolic names of bundles that are ignored in bundle list.
   * The state of these bundles has no effect on the bundle status check.
   * @return List of regular expressions for symbolic bundle names.
   */
  public List&lt;Pattern&gt; getBundleStatusWhitelistBundleNames() {
<span class="nc" id="L260">    return this.bundleStatusWhitelistBundleNames;</span>
  }

  /**
   * @param bundleStatusWhitelistBundleNames Patterns for symbolic names of bundles that are ignored in bundle list
   */
  public void setBundleStatusWhitelistBundleNames(List&lt;String&gt; bundleStatusWhitelistBundleNames) {
<span class="nc" id="L267">    this.bundleStatusWhitelistBundleNames = bundleStatusWhitelistBundleNames.stream()</span>
<span class="nc" id="L268">        .map(Pattern::compile)</span>
<span class="nc" id="L269">        .collect(Collectors.toList());</span>
<span class="nc" id="L270">  }</span>

  /**
   * System ready status JSON URL. If an URL is configured the system ready status is checked.
   * @return URL
   */
  public String getSystemReadyUrl() {
<span class="nc" id="L277">    return this.systemReadyUrl;</span>
  }

  /**
   * @param systemReadyUrl System ready status JSON URL. If an URL is configured the system ready status is checked.
   */
  public void setSystemReadyUrl(String systemReadyUrl) {
<span class="nc" id="L284">    this.systemReadyUrl = systemReadyUrl;</span>
<span class="nc" id="L285">  }</span>

  /**
   * Number of seconds to wait as maximum for a positive system ready status check.
   * If this limit is reached and the system ready status is still not positive the install of the package proceeds
   * anyway.
   * @return Limit in seconds
   */
  public int getSystemReadyWaitLimitSec() {
<span class="nc" id="L294">    return this.systemReadyWaitLimitSec;</span>
  }

  /**
   * @param systemReadyWaitLimitSec Number of seconds to wait as maximum for a positive system ready status check
   */
  public void setSystemReadyWaitLimitSec(int systemReadyWaitLimitSec) {
<span class="nc" id="L301">    this.systemReadyWaitLimitSec = systemReadyWaitLimitSec;</span>
<span class="nc" id="L302">  }</span>

  /**
   * Package Manager installation status JSON URL. If an URL is configured the installation status of packages and
   * embedded packages is checked before it is tried to upload and install a new package and after each upload.
   * If not all packages are installed the upload is delayed up to {link #getPackageManagerInstallStatusWaitLimit()}
   * seconds, every 5 seconds the activation status is checked anew.
   * Expected is an URL like: http://localhost:4502/crx/packmgr/installstatus.jsp
   * @return URL
   */
  public String getPackageManagerInstallStatusURL() {
<span class="nc" id="L313">    return this.packageManagerInstallStatusURL;</span>
  }

  /**
   * @param packageManagerInstallStatusURL Package Manager installation status JSON URL
   */
  public void setPackageManagerInstallStatusURL(String packageManagerInstallStatusURL) {
<span class="nc" id="L320">    this.packageManagerInstallStatusURL = packageManagerInstallStatusURL;</span>
<span class="nc" id="L321">  }</span>

  /**
   * Number of seconds to wait as maximum for a positive package manager install status check.
   * If this limit is reached and the packager manager install status is still not positive the install of the package
   * proceeds anyway.
   * @return Limit in seconds
   */
  public int getPackageManagerInstallStatusWaitLimitSec() {
<span class="nc" id="L330">    return this.packageManagerInstallStatusWaitLimitSec;</span>
  }

  /**
   * @param packageManagerInstallStatusWaitLimitSec Number of seconds to wait as maximum for a positive package manager
   *          install status check
   */
  public void setPackageManagerInstallStatusWaitLimitSec(int packageManagerInstallStatusWaitLimitSec) {
<span class="nc" id="L338">    this.packageManagerInstallStatusWaitLimitSec = packageManagerInstallStatusWaitLimitSec;</span>
<span class="nc" id="L339">  }</span>

  /**
   * If set to true also self-signed certificates are accepted.
   * @return Relaced SSL check
   */
  public boolean isRelaxedSSLCheck() {
<span class="nc" id="L346">    return this.relaxedSSLCheck;</span>
  }

  /**
   * @param relaxedSSLCheck If set to true also self-signed certificates are accepted
   */
  public void setRelaxedSSLCheck(boolean relaxedSSLCheck) {
<span class="nc" id="L353">    this.relaxedSSLCheck = relaxedSSLCheck;</span>
<span class="nc" id="L354">  }</span>

  /**
   * HTTP connection timeout (in seconds).
   * @return Timeout
   */
  public int getHttpConnectTimeoutSec() {
<span class="nc" id="L361">    return this.httpConnectTimeoutSec;</span>
  }

  /**
   * @param httpConnectTimeoutSec HTTP connection timeout (in seconds)
   */
  public void setHttpConnectTimeoutSec(int httpConnectTimeoutSec) {
<span class="nc" id="L368">    this.httpConnectTimeoutSec = httpConnectTimeoutSec;</span>
<span class="nc" id="L369">  }</span>

  /**
   * HTTP socket timeout (in seconds).
   * @return Timeout
   */
  public int getHttpSocketTimeoutSec() {
<span class="nc" id="L376">    return this.httpSocketTimeoutSec;</span>
  }

  /**
   * @param httpSocketTimeoutSec HTTP socket timeout (in seconds)
   */
  public void setHttpSocketTimeoutSec(int httpSocketTimeoutSec) {
<span class="nc" id="L383">    this.httpSocketTimeoutSec = httpSocketTimeoutSec;</span>
<span class="nc" id="L384">  }</span>

  /**
   * HTTP proxies from maven settings
   * @return List of proxies
   */
  public List&lt;Proxy&gt; getProxies() {
<span class="nc" id="L391">    return this.proxies;</span>
  }

  /**
   * @param proxies HTTP proxies from maven settings
   */
  public void setProxies(List&lt;Proxy&gt; proxies) {
<span class="nc" id="L398">    this.proxies = proxies;</span>
<span class="nc" id="L399">  }</span>

  /**
   * Log level to be used to log responses from package manager (which may get huge for large packages).
   * @return Log level (DEBUG or INFO). Default is INFO.
   */
  public String getPackageManagerOutputLogLevel() {
<span class="nc" id="L406">    return this.packageManagerOutputLogLevel;</span>
  }

  /**
   * @param packageManagerOutputLogLevel Log level to be used to log responses from package manager
   */
  public void setPackageManagerOutputLogLevel(String packageManagerOutputLogLevel) {
<span class="nc" id="L413">    this.packageManagerOutputLogLevel = packageManagerOutputLogLevel;</span>
<span class="nc" id="L414">  }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>